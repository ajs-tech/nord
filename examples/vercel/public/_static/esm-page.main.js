var Pn=Object.create;var Qe=Object.defineProperty;var In=Object.getOwnPropertyDescriptor;var _n=Object.getOwnPropertyNames;var qn=Object.getPrototypeOf,Ln=Object.prototype.hasOwnProperty;var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),m=(e,t)=>{for(var r in t)Qe(e,r,{get:t[r],enumerable:!0})},Mn=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of _n(t))!Ln.call(e,n)&&n!==r&&Qe(e,n,{get:()=>t[n],enumerable:!(o=In(t,n))||o.enumerable});return e};var R=(e,t,r)=>(r=e!=null?Pn(qn(e)):{},Mn(t||!e||!e.__esModule?Qe(r,"default",{value:e,enumerable:!0}):r,e));var D=L(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.toBoolean=te.isObject=te.isDefined=void 0;var $n=e=>e!=null;te.isDefined=$n;var Un=e=>typeof e=="object"&&e!==null;te.isObject=Un;var Hn=e=>e!==!1&&e!==void 0&&e!==null;te.toBoolean=Hn});var ze=L(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.isToddleFormula=void 0;var xn=e=>Object.hasOwn(e,"formula");we.isToddleFormula=xn});var U=L(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.isFormula=Eo;ge.isFormulaApplyOperation=Vn;ge.applyFormula=M;var Se=D(),Bn=ze();function Eo(e){return e&&typeof e=="object"&&typeof e.type=="string"}function Vn(e){return e.type==="apply"}function M(e,t){if(!Eo(e))return e;try{switch(e.type){case"value":return e.value;case"path":{let r=t.data;for(let o of e.path)if(r&&typeof r=="object")r=r[o];else return null;return r}case"switch":{for(let r of e.cases)if((0,Se.toBoolean)(M(r.condition,t)))return M(r.formula,t);return M(e.default,t)}case"or":{for(let r of e.arguments)if((0,Se.toBoolean)(M(r.formula,t)))return!0;return!1}case"and":{for(let r of e.arguments)if(!(0,Se.toBoolean)(M(r.formula,t)))return!1;return!0}case"function":{let r=e.package??t.package,o=(t.toddle??globalThis.toddle)?.getCustomFormula(e.name,r),n=(t.toddle??globalThis.toddle).getFormula(e.name);if((0,Se.isDefined)(o)){let a=e.arguments.reduce((s,l,u)=>({...s,[l.name??`${u}`]:l.isFunction?f=>M(l.formula,{...t,data:{...t.data,Args:t.data.Args?{...f,"@toddle.parent":t.data.Args}:f}}):M(l.formula,t)}),{});try{return(0,Bn.isToddleFormula)(o)?M(o.formula,{...t,data:{...t.data,Args:a}}):o.handler(a,{root:t.root??document,env:t.env})}catch(s){return t.toddle.errors.push(s),t.env?.logErrors&&console.error(s),null}}else if(typeof n=="function"){let a=(e.arguments??[]).map(s=>s.isFunction?l=>M(s.formula,{...t,data:{...t.data,Args:t.data.Args?{...l,"@toddle.parent":t.data.Args}:l}}):M(s.formula,t));try{return n(a,t)}catch(s){return t.toddle.errors.push(s),t.env?.logErrors&&console.error(s),null}}return t.env?.logErrors&&console.error(`Could not find formula ${e.name} in package ${r??""}`,e),null}case"object":return Object.fromEntries(e.arguments?.map(r=>[r.name,M(r.formula,t)])??[]);case"record":return Object.fromEntries(e.entries.map(r=>[r.name,M(r.formula,t)]));case"array":return e.arguments.map(r=>M(r.formula,t));case"apply":{let r=t.component.formulas?.[e.name];if(!r)return t.env?.logErrors&&console.log("Component does not have a formula with the name ",e.name),null;let o=Object.fromEntries(e.arguments.map(s=>s.isFunction?[s.name,l=>M(s.formula,{...t,data:{...t.data,Args:t.data.Args?{...l,"@toddle.parent":t.data.Args}:l}})]:[s.name,M(s.formula,t)])),n={...t.data,Args:t.data.Args?{...o,"@toddle.parent":t.data.Args}:o},a=t.formulaCache?.[e.name]?.get(n);if(a?.hit)return a.data;{let s=M(r.formula,{...t,data:n});return t.formulaCache?.[e.name]?.set(n,s),s}}default:t.env?.logErrors&&console.error("Could not recognize formula",e)}}catch(r){return t.env?.logErrors&&console.error(r),null}}});var z=L(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.deepSortObject=T.easySort=T.sortObjectEntries=T.set=T.filterObject=T.groupBy=T.omitPaths=T.omitKeys=T.omit=T.mapValues=T.mapObject=T.isObject=void 0;T.get=Oo;var Kn=D(),Jn=e=>typeof e=="object"&&e!==null;T.isObject=Jn;var Wn=(e,t)=>Object.fromEntries(Object.entries(e).map(t));T.mapObject=Wn;var Gn=(e,t)=>(0,T.mapObject)(e,([r,o])=>[r,t(o)]);T.mapValues=Gn;var Qn=(e,t)=>{let[r,...o]=t,n=Array.isArray(e)?[...e]:(0,T.isObject)(e)?{...e}:{};return o.length===0?delete n[r]:n[r]=(0,T.omit)(n[r],o),n};T.omit=Qn;var zn=(e,t)=>Object.fromEntries(Object.entries(e).filter(([r])=>!t.includes(r)));T.omitKeys=zn;var Zn=(e,t)=>t.reduce((r,o)=>(0,T.omit)(r,o),{...e});T.omitPaths=Zn;var Yn=(e,t)=>e.reduce((r,o)=>{let n=t(o);return r[n]=r[n]??[],r[n].push(o),r},{});T.groupBy=Yn;var Xn=(e,t)=>Object.fromEntries(Object.entries(e).filter(t));T.filterObject=Xn;function Oo(e,[t,...r]){return r.length===0?e?.[t]:Oo(e?.[t],r)}var ea=(e,t,r)=>{let[o,...n]=t,a=Array.isArray(e)?[...e]:(0,T.isObject)(e)?{...e}:{};return a[o]=n.length===0?r:(0,T.set)(a[o],n,r),a};T.set=ea;var ta=(e,t,r=!0)=>(0,T.easySort)(Object.entries(e),t,r);T.sortObjectEntries=ta;var ra=(e,t,r=!0)=>[...e].sort((o,n)=>{let a=t(o),s=t(n);return a===s?0:(a>s?1:-1)*(r?1:-1)});T.easySort=ra;var oa=e=>(0,Kn.isDefined)(e)?Array.isArray(e)?e.map(t=>(0,T.deepSortObject)(t)):typeof e=="object"&&Object.keys(e).length>0?[...Object.keys(e)].sort().reduce((t,r)=>(t[r]=(0,T.deepSortObject)(e[r]),t),{}):e:e;T.deepSortObject=oa});var jo=L(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.hash=void 0;var na=(e,t=0)=>{let r=3735928559^t,o=1103547991^t;for(let n=0,a;n<e.length;n++)a=e.charCodeAt(n),r=Math.imul(r^a,2654435761),o=Math.imul(o^a,1597334677);return r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(o^o>>>13,3266489909),o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(r^r>>>13,3266489909),4294967296*(2097151&o)+(r>>>0)};Ce.hash=na});var Fo=L(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ApiMethod=void 0;var Ro;(function(e){e.GET="GET",e.POST="POST",e.DELETE="DELETE",e.PUT="PUT",e.PATCH="PATCH",e.HEAD="HEAD",e.OPTIONS="OPTIONS"})(Ro||(Ee.ApiMethod=Ro={}))});var Ze=L(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.functionFormula=V.pathFormula=V.valueFormula=void 0;V.getFormulasInFormula=$;V.getFormulasInAction=se;var Oe=D(),To=U(),aa=ze(),sa=e=>({type:"value",value:e});V.valueFormula=sa;var ia=e=>({type:"path",path:e});V.pathFormula=ia;var la=(e,t)=>({type:"function",name:e,package:t?.package,arguments:t?.arguments??[],variableArguments:t?.variableArguments});V.functionFormula=la;function*$({formula:e,globalFormulas:t,path:r=[],visitedFormulas:o=new Set}){if((0,Oe.isDefined)(e))switch(yield[r,e],e.type){case"path":case"value":break;case"record":for(let[n,a]of e.entries.entries())yield*$({formula:a.formula,globalFormulas:t,path:[...r,"entries",n,"formula"],visitedFormulas:o});break;case"function":{let n=[e.package,e.name].filter(Oe.isDefined).join("/"),a=!o.has(n);o.add(n);let s=e.package?t.packages?.[e.package]?.formulas?.[e.name]:t.formulas?.[e.name];for(let[l,u]of(e.arguments??[]).entries())yield*$({formula:u.formula,globalFormulas:t,path:[...r,"arguments",l,"formula"],visitedFormulas:o});s&&(0,aa.isToddleFormula)(s)&&a&&(yield*$({formula:s.formula,globalFormulas:t,path:[...r,"formula"],visitedFormulas:o}));break}case"array":case"or":case"and":case"object":for(let[n,a]of(e.arguments??[]).entries())yield*$({formula:a.formula,globalFormulas:t,path:[...r,"arguments",n,"formula"],visitedFormulas:o});break;case"apply":for(let[n,a]of(e.arguments??[]).entries())yield*$({formula:a.formula,globalFormulas:t,path:[...r,"arguments",n,"formula"],visitedFormulas:o});break;case"switch":for(let[n,a]of e.cases.entries())yield*$({formula:a.condition,globalFormulas:t,path:[...r,"cases",n,"condition"],visitedFormulas:o}),yield*$({formula:a.formula,globalFormulas:t,path:[...r,"cases",n,"formula"],visitedFormulas:o});yield*$({formula:e.default,globalFormulas:t,path:[...r,"default"],visitedFormulas:o});break}}function*se({action:e,globalFormulas:t,path:r=[],visitedFormulas:o=new Set}){if((0,Oe.isDefined)(e))switch(e.type){case"Fetch":for(let[n,a]of Object.entries(e.inputs??{}))yield*$({formula:a.formula,globalFormulas:t,path:[...r,"input",n,"formula"],visitedFormulas:o});for(let[n,a]of Object.entries(e.onSuccess?.actions??{}))yield*se({action:a,globalFormulas:t,path:[...r,"onSuccess","actions",n],visitedFormulas:o});for(let[n,a]of Object.entries(e.onError?.actions??{}))yield*se({action:a,globalFormulas:t,path:[...r,"onError","actions",n],visitedFormulas:o});for(let[n,a]of Object.entries(e.onMessage?.actions??{}))yield*se({action:a,globalFormulas:t,path:[...r,"onMessage","actions",n],visitedFormulas:o});break;case"Custom":case void 0:(0,To.isFormula)(e.data)&&(yield*$({formula:e.data,globalFormulas:t,path:[...r,"data"],visitedFormulas:o}));for(let[n,a]of Object.entries(e.arguments??{}))yield*$({formula:a.formula,globalFormulas:t,path:[...r,"arguments",n,"formula"],visitedFormulas:o});for(let[n,a]of Object.entries(e.events??{}))for(let[s,l]of Object.entries(a.actions??{}))yield*se({action:l,globalFormulas:t,path:[...r,"events",n,"actions",s],visitedFormulas:o});break;case"SetVariable":case"SetURLParameter":case"TriggerEvent":yield*$({formula:e.data,globalFormulas:t,path:[...r,"data"],visitedFormulas:o});break;case"TriggerWorkflow":for(let[n,a]of Object.entries(e.parameters??{}))yield*$({formula:a.formula,globalFormulas:t,path:[...r,"parameters",n,"formula"],visitedFormulas:o});break;case"Switch":(0,Oe.isDefined)(e.data)&&(0,To.isFormula)(e.data)&&(yield*$({formula:e.data,globalFormulas:t,path:[...r,"data"],visitedFormulas:o}));for(let[n,a]of e.cases.entries()){yield*$({formula:a.condition,globalFormulas:t,path:[...r,"cases",n,"condition"],visitedFormulas:o});for(let[s,l]of Object.entries(a.actions))yield*se({action:l,globalFormulas:t,path:[...r,"cases",n,"actions",s],visitedFormulas:o})}for(let[n,a]of Object.entries(e.default.actions))yield*se({action:a,globalFormulas:t,path:[...r,"default","actions",n],visitedFormulas:o});break}}});var ko=L(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.LegacyToddleApi=void 0;var No=U(),Z=Ze(),ua=D(),Ye=class{api;key;globalFormulas;_apiReferences;constructor(t,r,o){this.api=t,this.key=r,this.globalFormulas=o}get apiReferences(){if(this._apiReferences)return this._apiReferences;let t=new Set,r=o=>{if((0,ua.isDefined)(o))switch(o.type){case"path":o.path[0]==="Apis"&&t.add(o.path[1]);break;case"value":break;case"record":o.entries.forEach(n=>r(n.formula));break;case"function":case"array":case"or":case"and":case"apply":case"object":o.arguments?.forEach(n=>r(n.formula));break;case"switch":o.cases.forEach(n=>{r(n.condition),r(n.formula)});break}};return r(this.api.autoFetch),r(this.api.url),Object.values(this.api.path??{}).forEach(o=>r(o.formula)),Object.values(this.api.queryParams??{}).forEach(o=>r(o.formula)),(0,No.isFormula)(this.api.headers)?r(this.api.headers):Object.values(this.api.headers??{}).forEach(o=>{r(o)}),r(this.api.body),this._apiReferences=t,t}get name(){return this.api.name}get type(){return this.api.type}get autoFetch(){return this.api.autoFetch}get url(){return this.api.url}get path(){return this.api.path}get proxy(){return this.api.proxy}get queryParams(){return this.api.queryParams}get headers(){return this.api.headers}get method(){return this.api.method}get body(){return this.api.body}get auth(){return this.api.auth}get throttle(){return this.api.throttle}get debounce(){return this.api.debounce}get onCompleted(){return this.api.onCompleted}get onFailed(){return this.api.onFailed}*formulasInApi(){let t=this.api,r=this.key;yield*(0,Z.getFormulasInFormula)({formula:t.autoFetch,globalFormulas:this.globalFormulas,path:["apis",r,"autoFetch"]}),yield*(0,Z.getFormulasInFormula)({formula:t.url,globalFormulas:this.globalFormulas,path:["apis",r,"url"]});for(let[o,n]of Object.entries(t.path??{}))yield*(0,Z.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"path",o,"formula"]});for(let[o,n]of Object.entries(t.queryParams??{}))yield*(0,Z.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"queryParams",o,"formula"]});if((0,No.isFormula)(t.headers))yield*(0,Z.getFormulasInFormula)({formula:t.headers,globalFormulas:this.globalFormulas,path:["apis",r,"headers"]});else for(let[o,n]of Object.entries(t.headers??{}))yield*(0,Z.getFormulasInFormula)({formula:n,globalFormulas:this.globalFormulas,path:["apis",r,"headers",o]});yield*(0,Z.getFormulasInFormula)({formula:t.body,globalFormulas:this.globalFormulas,path:["apis",r,"body"]});for(let[o,n]of Object.entries(t.onCompleted?.actions??{}))yield*(0,Z.getFormulasInAction)({action:n,globalFormulas:this.globalFormulas,path:["apis",r,"onCompleted","actions",o]});for(let[o,n]of Object.entries(t.onFailed?.actions??{}))yield*(0,Z.getFormulasInAction)({action:n,globalFormulas:this.globalFormulas,path:["apis",r,"onFailed","actions",o]})}};je.LegacyToddleApi=Ye});var Do=L(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.getActionsInAction=ie;var ca=D();function*ie(e,t=[]){if((0,ca.isDefined)(e))switch(yield[t,e],e.type){case"SetVariable":case"SetURLParameter":case"TriggerEvent":case"TriggerWorkflow":break;case"Fetch":for(let[r,o]of Object.entries(e.onSuccess?.actions??{}))yield*ie(o,[...t,"onSuccess","actions",r]);for(let[r,o]of Object.entries(e.onError?.actions??{}))yield*ie(o,[...t,"onError","actions",r]);for(let[r,o]of Object.entries(e.onMessage?.actions??{}))yield*ie(o,[...t,"onMessage","actions",r]);break;case"Custom":case void 0:for(let[r,o]of Object.entries(e.events??{}))for(let[n,a]of Object.entries(o?.actions??{}))yield*ie(a,[...t,"events",r,"actions",n]);break;case"Switch":for(let[r,o]of e.cases.entries())for(let[n,a]of Object.entries(o?.actions??{}))yield*ie(a,[...t,"cases",r,"actions",n]);for(let[r,o]of Object.entries(e.default.actions))yield*ie(o,[...t,"default","actions",r]);break}}});var Po=L(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.ToddleApiV2=void 0;var et=Do(),_=Ze(),da=D(),tt=class{api;_apiReferences;key;globalFormulas;constructor(t,r,o){this.api=t,this.key=r,this.globalFormulas=o}get apiReferences(){if(this._apiReferences)return this._apiReferences;let t=new Set,r=o=>{if((0,da.isDefined)(o))switch(o.type){case"path":o.path[0]==="Apis"&&t.add(o.path[1]);break;case"value":break;case"record":o.entries.forEach(n=>r(n.formula));break;case"function":case"array":case"or":case"and":case"apply":case"object":o.arguments?.forEach(n=>r(n.formula));break;case"switch":o.cases.forEach(n=>{r(n.condition),r(n.formula)});break}};return r(this.api.autoFetch),r(this.api.url),Object.values(this.api.path??{}).forEach(o=>r(o.formula)),Object.values(this.api.headers??{}).forEach(o=>r(o.formula)),r(this.api.body),Object.values(this.api.inputs).forEach(o=>r(o.formula)),Object.values(this.api.queryParams??{}).forEach(o=>{r(o.formula)}),r(this.api.server?.proxy?.enabled?.formula),r(this.api.server?.ssr?.enabled?.formula),r(this.api.client?.debounce?.formula),Object.values(this.api.redirectRules??{}).forEach(o=>{r(o.formula)}),r(this.api.isError?.formula),r(this.api.timeout?.formula),t.delete(this.key),this._apiReferences=t,t}get version(){return this.api.version}get name(){return this.api.name}get type(){return this.api.type}get autoFetch(){return this.api.autoFetch}get url(){return this.api.url}get path(){return this.api.path}get headers(){return this.api.headers}set headers(t){this.api.headers=t}get method(){return this.api.method}get body(){return this.api.body}get inputs(){return this.api.inputs}get queryParams(){return this.api.queryParams}get server(){return this.api.server}get client(){return this.api.client}get redirectRules(){return this.api.redirectRules}get isError(){return this.api.isError}get timeout(){return this.api.timeout}*formulasInApi(){let t=this.api,r=this.key;for(let[o,n]of Object.entries(this.api.inputs))yield*(0,_.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"inputs",o,"formula"]});yield*(0,_.getFormulasInFormula)({formula:t.autoFetch,globalFormulas:this.globalFormulas,path:["apis",r,"autoFetch"]}),yield*(0,_.getFormulasInFormula)({formula:t.url,globalFormulas:this.globalFormulas,path:["apis",r,"url"]});for(let[o,n]of Object.entries(t.path??{}))yield*(0,_.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"path",o,"formula"]});for(let[o,n]of Object.entries(t.queryParams??{}))yield*(0,_.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"queryParams",o,"formula"]}),yield*(0,_.getFormulasInFormula)({formula:n.enabled,globalFormulas:this.globalFormulas,path:["apis",r,"queryParams",o,"enabled"]});for(let[o,n]of Object.entries(t.headers??{}))yield*(0,_.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"headers",o,"formula"]}),yield*(0,_.getFormulasInFormula)({formula:n.enabled,globalFormulas:this.globalFormulas,path:["apis",r,"headers",o,"enabled"]});yield*(0,_.getFormulasInFormula)({formula:t.body,globalFormulas:this.globalFormulas,path:["apis",r,"body"]});for(let[o,n]of Object.entries(t.client?.onCompleted?.actions??{}))yield*(0,_.getFormulasInAction)({action:n,globalFormulas:this.globalFormulas,path:["apis",r,"client","onCompleted","actions",o]});for(let[o,n]of Object.entries(t.client?.onFailed?.actions??{}))yield*(0,_.getFormulasInAction)({action:n,globalFormulas:this.globalFormulas,path:["apis",r,"client","onFailed","actions",o]});yield*(0,_.getFormulasInFormula)({formula:t.client?.debounce?.formula,globalFormulas:this.globalFormulas,path:["apis",r,"client","debounce","formula"]});for(let[o,n]of Object.entries(t.client?.onMessage?.actions??{}))yield*(0,_.getFormulasInAction)({action:n,globalFormulas:this.globalFormulas,path:["apis",r,"client","onMessage","actions",o]});for(let[o,n]of Object.entries(t.redirectRules??{}))yield*(0,_.getFormulasInFormula)({formula:n.formula,globalFormulas:this.globalFormulas,path:["apis",r,"redirectRules",o,"formula"]});yield*(0,_.getFormulasInFormula)({formula:t.isError?.formula,globalFormulas:this.globalFormulas,path:["apis",r,"isError","formula"]}),yield*(0,_.getFormulasInFormula)({formula:t.timeout?.formula,globalFormulas:this.globalFormulas,path:["apis",r,"timeout","formula"]}),yield*(0,_.getFormulasInFormula)({formula:t.server?.proxy?.enabled.formula,globalFormulas:this.globalFormulas,path:["apis",r,"server","proxy","enabled","formula"]}),yield*(0,_.getFormulasInFormula)({formula:t.server?.ssr?.enabled?.formula,globalFormulas:this.globalFormulas,path:["apis",r,"server","ssr","enabled","formula"]})}*actionModelsInApi(){for(let[t,r]of Object.entries(this.api.client?.onCompleted?.actions??{}))yield*(0,et.getActionsInAction)(r,["apis",this.key,"client","onCompleted","actions",t]);for(let[t,r]of Object.entries(this.api.client?.onFailed?.actions??{}))yield*(0,et.getActionsInAction)(r,["apis",this.key,"client","onFailed","actions",t]);for(let[t,r]of Object.entries(this.api.client?.onMessage?.actions??{}))yield*(0,et.getActionsInAction)(r,["apis",this.key,"client","onData","actions",t])}};Re.ToddleApiV2=tt});var Fe=L(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.sortApiEntries=N.sortApiObjects=N.createApiEvent=N.isApiError=N.requestHash=N.getBaseUrl=N.getRequestHeaders=N.getRequestQueryParams=N.getRequestPath=N.applyAbortSignal=N.getUrl=N.createApiRequest=N.isLegacyApi=N.NON_BODY_RESPONSE_CODES=void 0;var Y=U(),Io=z(),fa=jo(),re=D(),le=Fo(),_o=ko(),pa=Po();N.NON_BODY_RESPONSE_CODES=[101,204,205,304];var ma=e=>e instanceof _o.LegacyToddleApi?!0:!("version"in e);N.isLegacyApi=ma;var ga=({api:e,formulaContext:t,baseUrl:r,defaultHeaders:o})=>{let n=(0,N.getUrl)(e,t,r),a=Aa({api:e,formulaContext:t,defaultHeaders:o});return{url:n,requestSettings:a}};N.createApiRequest=ga;var ha=(e,t,r)=>{let o="",n=new URLSearchParams,a,s=(0,Y.applyFormula)(e.url,t);if(["string","number"].includes(typeof s)){let i=typeof s=="number"?String(s):s;try{a=new URL(i,r),o=a.pathname,n=a.searchParams}catch{}}let l=(0,N.getRequestPath)(e.path,t),u=`${o}${l.length>0&&!o.endsWith("/")?"/":""}${l}`,f=new URLSearchParams([...n,...(0,N.getRequestQueryParams)(e.queryParams,t)]),A=[...f.entries()].length>0?`?${f.toString()}`:"";if(a){let i=new URL(a.origin,r);return i.pathname=u,i.search=f.toString(),i}else return new URL(`${u}${A}`,r)};N.getUrl=ha;var ya=[le.ApiMethod.POST,le.ApiMethod.DELETE,le.ApiMethod.PUT,le.ApiMethod.PATCH,le.ApiMethod.OPTIONS],ba=(e,t,r)=>{if(e.timeout){let o=(0,Y.applyFormula)(e.timeout.formula,r);typeof o=="number"&&!Number.isNaN(o)&&o>0&&(t.signal=AbortSignal.timeout(o))}};N.applyAbortSignal=ba;var Aa=({api:e,formulaContext:t,defaultHeaders:r})=>{let o=Object.values(le.ApiMethod).includes(e.method)?e.method:le.ApiMethod.GET,n=(0,N.getRequestHeaders)({apiHeaders:e.headers,formulaContext:t,defaultHeaders:r}),a=ja({api:e,formulaContext:t,headers:n,method:o});n.get("content-type")==="multipart/form-data"&&n.delete("content-type");let s={method:o,headers:n,body:a};return(0,N.applyAbortSignal)(e,s,t),s},va=(e,t)=>(0,Io.sortObjectEntries)(e??{},([r,o])=>o.index).map(([r,o])=>(0,Y.applyFormula)(o.formula,t)).join("/");N.getRequestPath=va;var wa=(e,t)=>{let r=new URLSearchParams;return Object.entries(e??{}).forEach(([o,n])=>{if(!((0,re.isDefined)(n.enabled)?(0,Y.applyFormula)(n.enabled,t):!0))return;let s=(0,Y.applyFormula)(n.formula,t);if((0,re.isDefined)(s))if(Array.isArray(s))s.forEach(l=>r.append(o,String(l)));else if((0,re.isObject)(s)){let l=(u,f)=>{Object.entries(u).forEach(([A,i])=>{if(!Array.isArray(i)&&(0,re.isObject)(i))return l(i,`${f}[${A}]`);r.set(`${f}[${A}]`,String(i))})};l(s,o)}else r.set(o,String(s))}),r};N.getRequestQueryParams=wa;var Sa=({apiHeaders:e,formulaContext:t,defaultHeaders:r})=>{let o=new Headers(r);return Object.entries(e??{}).forEach(([n,a])=>{if((0,re.isDefined)(a.enabled)?(0,Y.applyFormula)(a.enabled,t):!0){let l=(0,Y.applyFormula)(a.formula,t);if((0,re.isDefined)(l))try{o.set(n.trim(),(typeof l=="string"?l:String(l)).trim())}catch{}}}),o};N.getRequestHeaders=Sa;var Ca=({origin:e,url:t})=>!(0,re.isDefined)(t)||t===""||t.startsWith("/")?e+t:t;N.getBaseUrl=Ca;var Ea=(e,t)=>(0,fa.hash)(JSON.stringify({url:e.href,method:t.method,headers:(0,Io.omitKeys)(Object.fromEntries(Object.entries(t.headers??{})),["host","cookie"]),body:t.body??null}));N.requestHash=Ea;var Oa=({apiName:e,response:t,formulaContext:r,errorFormula:o,performance:n})=>{let a=o?(0,Y.applyFormula)(o.formula,{component:r.component,package:r.package,toddle:r.toddle,data:{Attributes:{},Args:r.data.Args,Apis:{[e]:{isLoading:!1,data:t.body,error:null,response:{status:t.status,headers:t.headers,performance:n}}}},env:r.env}):null;return a==null?!t.ok:(0,re.toBoolean)(a)};N.isApiError=Oa;var ja=({api:e,formulaContext:t,headers:r,method:o})=>{if(!e.body||!ya.includes(o))return;let n=(0,Y.applyFormula)(e.body,t);if(n)switch(r.get("content-type")){case"application/x-www-form-urlencoded":return typeof n=="object"&&n!==null?Object.entries(n).map(([a,s])=>Array.isArray(s)?s.map(l=>`${encodeURIComponent(a)}=${encodeURIComponent(l)}`).join("&"):`${encodeURIComponent(a)}=${encodeURIComponent(String(s))}`).join("&"):"";case"multipart/form-data":{let a=new FormData;return typeof n=="object"&&n!==null&&Object.entries(n).forEach(([s,l])=>{a.set(s,l)}),a}case"text/plain":return String(n);default:return JSON.stringify(n)}},Ra=(e,t)=>new CustomEvent(e,{detail:t});N.createApiEvent=Ra;var qo=(e,t)=>{let r=e.apiReferences.has(t.name),o=t.apiReferences.has(e.name);return r===o?0:r?1:-1},Fa=e=>{let t=new Map,r=(o,n)=>{let a=t.get(n);return a||(a=o.version===2?new pa.ToddleApiV2(o,n,{formulas:{},packages:{}}):new _o.LegacyToddleApi(o,n,{formulas:{},packages:{}}),t.set(n,a)),a};return[...e].sort(([o,n],[a,s])=>{let l=r(n,o),u=r(s,a);return qo(l,u)})};N.sortApiObjects=Fa;var Ta=e=>[...e].sort(([t,r],[o,n])=>qo(r,n));N.sortApiEntries=Ta});var Kr=L(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.parseJSONWithDate=ou;var ru=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:.\d{1,3})?Z$/;function ou(e){return JSON.parse(e,(t,r)=>typeof r=="string"&&r.length===24&&ru.test(r)?new Date(r):r)}});var on=L(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.STRING_TEMPLATE=void 0;var Iu=(e,t)=>`{{ ${_u[e]}.${t} }}`;Ne.STRING_TEMPLATE=Iu;var _u={cookies:"cookies"}});var ke=L((kc,an)=>{"use strict";an.exports=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var o,n,a;if(Array.isArray(t)){if(o=t.length,o!=r.length)return!1;for(n=o;n--!==0;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(a=Object.keys(t),o=a.length,o!==Object.keys(r).length)return!1;for(n=o;n--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=o;n--!==0;){var s=a[n];if(!e(t[s],r[s]))return!1}return!0}return t!==t&&r!==r}});var fn=L(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.isImageHeader=H.isJsonStreamHeader=H.isEventStreamHeader=H.isTextHeader=H.isJsonHeader=void 0;var Zu=e=>typeof e!="string"?!1:/^application\/(json|.*\+json)/.test(e);H.isJsonHeader=Zu;var Yu=e=>typeof e!="string"?!1:/^(text\/|application\/x-www-form-urlencoded|application\/(xml|.*\+xml))/.test(e);H.isTextHeader=Yu;var Xu=e=>typeof e!="string"?!1:/^text\/event-stream/.test(e);H.isEventStreamHeader=Xu;var ec=e=>typeof e!="string"?!1:/^(application\/stream\+json|application\/x-ndjson)/.test(e);H.isJsonStreamHeader=ec;var tc=e=>typeof e!="string"?!1:/^image\//.test(e);H.isImageHeader=tc});var pn=L(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.REWRITE_HEADER=x.PROXY_URL_HEADER=x.validateUrl=x.isLocalhostHostname=x.isLocalhostUrl=void 0;var rc=["http://localhost:54404","http://preview.localhost:54404"],oc=e=>rc.some(t=>e.startsWith(t));x.isLocalhostUrl=oc;var nc=e=>e==="localhost"||e==="127.0.0.1";x.isLocalhostHostname=nc;var ac=(e,t)=>{if(typeof e!="string")return!1;try{let r=new URL(e,t);return r.searchParams.forEach((o,n)=>{r.searchParams.set(n,o)}),r}catch{return!1}};x.validateUrl=ac;x.PROXY_URL_HEADER="x-toddle-url";x.REWRITE_HEADER="x-toddle-rewrite"});var Sn=L(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.toValidClassName=de.getClassName=void 0;var ic=5381,lc=(e,t)=>{let r=t.length;for(;r;)e=e*33^t.charCodeAt(--r);return e},uc=e=>lc(ic,e),cc=/(a)(d)/gi,Be=52,wn=e=>String.fromCharCode(e+(e>25?39:97));function dc(e){let t="",r;for(r=Math.abs(e);r>Be;r=r/Be|0)t=wn(r%Be)+t;return(wn(r%Be)+t).replace(cc,"$1-$2")}var fc=e=>dc(uc(JSON.stringify(e)));de.getClassName=fc;var pc=(e,t=!1)=>{let r=e.trim().replace(/\s+/g,"-");return t&&(r=r.replace(/[^a-zA-Z0-9-_]/g,o=>`\\${o}`)),/^[^a-zA-Z]/.test(r)&&(r=`_${r}`),r};de.toValidClassName=pc});var We=R(Fe()),pe=R(U()),Nn=R(z()),ne=R(D());var At={};m(At,{clearLocalStorage:()=>ut,clearSessionStorage:()=>ht,copyToClipboard:()=>ft,deleteFromLocalStorage:()=>ot,deleteFromSessionStorage:()=>ct,focus:()=>gt,gotToURL:()=>yt,interval:()=>lt,logToConsole:()=>dt,preventDefault:()=>it,saveToLocalStorage:()=>mt,saveToSessionStorage:()=>st,setSessionCookies:()=>pt,share:()=>at,sleep:()=>rt,stopPropagation:()=>bt});var rt={};m(rt,{default:()=>ka});var Lo=R(D()),Na=([e],t)=>{let r=Number(e);if(!(0,Lo.isDefined)(e)||Number.isNaN(e))throw new Error("Invalid delay value");let o=setTimeout(()=>t.triggerActionEvent("tick",null),r);t.abortSignal.addEventListener("abort",()=>{clearTimeout(o)})},ka=Na;var ot={};m(ot,{default:()=>Pa});var Da=async function([e]){if(typeof e!="string"||e.length===0)throw new Error(`Invalid key: ${e}`);window.localStorage.removeItem(e)},Pa=Da;var at={};m(at,{default:()=>_a});var nt=R(D()),Ia=([e,t,r])=>{let o=a=>(0,nt.isDefined)(a)&&typeof a=="string";if(!o(e)&&!o(t)&&!o(r))throw new Error("Either url, text or title must be provided");let n={};if(o(t)&&(n.title=t),o(r)&&(n.text=r),o(e)&&(n.url=e),(0,nt.isDefined)(navigator.share)&&navigator.canShare(n))return navigator.share(n)},_a=Ia;var st={};m(st,{default:()=>La});var qa=async function([e,t]){if(typeof e!="string"||e.length===0)throw new Error(`Invalid key: ${e}`);window.sessionStorage.setItem(e,JSON.stringify(t))},La=qa;var it={};m(it,{default:()=>$a});var Ma=(e,t,r)=>{r?.preventDefault?.()},$a=Ma;var lt={};m(lt,{default:()=>Ha});var Mo=R(D()),Ua=([e],t)=>{let r=Number(e);if(!(0,Mo.isDefined)(e)||Number.isNaN(e))throw new Error("Invalid delay value");let o=setInterval(()=>t.triggerActionEvent("tick",null),r);t.abortSignal.addEventListener("abort",()=>{clearInterval(o)})},Ha=Ua;var ut={};m(ut,{default:()=>Ba});var xa=async function(){window.localStorage.clear()},Ba=xa;var ct={};m(ct,{default:()=>Ka});var Va=async function([e]){if(typeof e!="string"||e.length===0)throw new Error(`Invalid key: ${e}`);window.sessionStorage.removeItem(e)},Ka=Va;var dt={};m(dt,{default:()=>Wa});var Ja=([e,t])=>{console.log(e,t)},Wa=Ja;var ft={};m(ft,{default:()=>Qa});var Ga=([e])=>{if(typeof e!="string")throw new Error("Input value must be a string");return navigator.clipboard.writeText(e)},Qa=Ga;var pt={};m(pt,{default:()=>Za});var za=async function([e,t],r){let o=[typeof e=="string"?`name=access_token&value=${encodeURIComponent(e)}`:void 0,isNaN(Number(t))?void 0:`ttl=${t}`].filter(a=>a).join("&"),n=await fetch(`/.toddle/cookies/set-session-cookie?${o}`);n.ok?r.triggerActionEvent("Success",void 0):r.triggerActionEvent("Error",new Error(await n.text()))},Za=za;var mt={};m(mt,{default:()=>Xa});var Ya=async function([e,t]){if(typeof e!="string"||e.length===0)throw new Error(`Invalid key: ${e}`);window.localStorage.setItem(e,JSON.stringify(t))},Xa=Ya;var gt={};m(gt,{default:()=>ts});var es=([e])=>{e instanceof HTMLElement&&e.focus()},ts=es;var ht={};m(ht,{default:()=>os});var rs=async function(){window.sessionStorage.clear()},os=rs;var yt={};m(yt,{default:()=>as});var ns=([e],t)=>{typeof e=="string"&&(t.env.runtime==="preview"?window.parent?.postMessage({type:"blockedNavigation",url:e},"*"):window.location.href=e)},as=ns;var bt={};m(bt,{default:()=>is});var ss=(e,t,r)=>{r?.stopPropagation?.()},is=ss;var fo={};m(fo,{absolute:()=>br,add:()=>uo,append:()=>Nr,boolean:()=>oo,branchName:()=>er,canShare:()=>Lt,capitalize:()=>ao,clamp:()=>Wt,concatenate:()=>or,currentURL:()=>Gt,dateFromString:()=>gr,dateFromTimestamp:()=>Zr,decodeBase64:()=>tr,decodeURIComponent:()=>Mt,defaultTo:()=>Et,deleteKey:()=>vr,divide:()=>mr,drop:()=>Kt,dropLast:()=>Ar,encodeBase64:()=>Pr,encodeJSON:()=>nr,encodeURIComponent:()=>kt,entries:()=>Sr,equals:()=>sr,every:()=>xr,filter:()=>xt,find:()=>Bt,findIndex:()=>Xt,findLast:()=>wt,first:()=>ur,flatten:()=>Er,formatDate:()=>Wr,formatNumber:()=>lo,fromEntries:()=>Ht,get:()=>fr,getCookie:()=>ro,getElementById:()=>Zt,getFromLocalStorage:()=>kr,getFromSessionStorage:()=>ar,getHttpOnlyCookie:()=>io,greaterOrEqueal:()=>co,greaterThan:()=>Ut,groupBy:()=>dr,includes:()=>Ft,indexOf:()=>no,isServer:()=>to,join:()=>Ir,json:()=>Or,keyBy:()=>Br,languages:()=>Yr,last:()=>Jt,lastIndexOf:()=>$r,lessOrEqual:()=>jr,lessThan:()=>Lr,lowercase:()=>so,map:()=>Qt,matches:()=>Gr,max:()=>qr,min:()=>Tt,minus:()=>cr,modulo:()=>zt,multiply:()=>Ot,not:()=>_t,notEqual:()=>vt,now:()=>Rr,number:()=>Dr,parseJSON:()=>Jr,parseURL:()=>Vt,power:()=>Ur,prepend:()=>pr,randomNumber:()=>jt,range:()=>_r,reduce:()=>Rt,replaceAll:()=>Yt,reverse:()=>lr,round:()=>Ct,roundDown:()=>Hr,roundUp:()=>It,set:()=>$t,shuffle:()=>Mr,size:()=>eo,some:()=>Pt,sort_by:()=>Dt,split:()=>Xr,squareRoot:()=>Fr,startsWith:()=>zr,string:()=>rr,sum:()=>Qr,take:()=>Tr,takeLast:()=>yr,timestamp:()=>wr,trim:()=>Cr,typeOf:()=>hr,unique:()=>ir,uppercase:()=>Nt,userAgent:()=>St});var vt={};m(vt,{default:()=>us});var ls=([e,t])=>!globalThis.toddle.isEqual(e,t),us=ls;var wt={};m(wt,{default:()=>cs,getArgumentInputData:()=>ds,handler:()=>$o});var $o=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.findLast((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.entries(e).findLast(([r,o])=>t({key:r,value:o}))?.[1]:null,cs=$o,ds=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r};var St={};m(St,{default:()=>ps});var fs=(e,{env:t})=>t.isServer?t.request?.headers["user-agent"]??null:window.navigator.userAgent,ps=fs;var Ct={};m(Ct,{default:()=>gs});var ms=([e,t])=>{if(typeof e!="number"||typeof t!="number")return null;let r=Math.max(1,Math.pow(10,t));return Math.round(e*r)/r},gs=ms;var Et={};m(Et,{default:()=>ys});var Uo=R(D()),hs=e=>{for(let t of e)if((0,Uo.toBoolean)(t))return t;return null},ys=hs;var Ot={};m(Ot,{default:()=>As});var bs=e=>e.some(t=>isNaN(Number(t)))?null:e.reduce((t,r)=>t*r,1),As=bs;var jt={};m(jt,{default:()=>ws});var vs=()=>Math.random(),ws=vs;var Rt={};m(Rt,{default:()=>Cs,getArgumentInputData:()=>Es});var Ss=([e,t,r])=>typeof t!="function"?null:Array.isArray(e)?e.reduce((o,n,a)=>t({result:o,item:n,index:a}),r):e&&typeof e=="object"?Object.entries(e).reduce((o,[n,a])=>t({result:o,key:n,value:a}),r):null,Cs=Ss,Es=([e,t,r],o,n)=>{if(o!==1)return n;if(Array.isArray(e))return{...n,Args:{item:e[0],index:0,result:r}};if(e&&typeof e=="object"){let[a]=Object.entries(e);if(a)return{...n,Args:{key:a[0],value:a[1],result:r}}}return n};var Ft={};m(Ft,{default:()=>js});var Os=([e,t])=>typeof e=="string"&&typeof t=="string"?e.includes(t):Array.isArray(e)?e.some(r=>globalThis.toddle.isEqual(r,t)):null,js=Os;var Tt={};m(Tt,{default:()=>Fs});var Rs=e=>Math.min(...e.map(Number)),Fs=Rs;var Nt={};m(Nt,{default:()=>Ns});var Ts=([e])=>typeof e!="string"?null:e.toLocaleUpperCase(),Ns=Ts;var kt={};m(kt,{default:()=>Ds});var ks=([e])=>typeof e!="string"?null:encodeURIComponent(e),Ds=ks;var Dt={};m(Dt,{default:()=>Is,getArgumentInputData:()=>_s});var Ps=([e,t,r])=>{if(!Array.isArray(e)||typeof t!="function"||typeof r!="boolean")return null;let o=r?1:-1;return[...e].sort((n,a)=>{let s=t({item:n}),l=t({item:a});if(Array.isArray(s)&&Array.isArray(l)){for(let u in s)if(s[u]!==l[u])return(s[u]>l[u]?1:-1)*o;return 0}return s===l?0:(s>l?1:-1)*o})},Is=Ps,_s=([e],t,r)=>t===1&&Array.isArray(e)?{...r,Args:{item:e[0]}}:r;var Pt={};m(Pt,{default:()=>qs,getArgumentInputData:()=>Ls,handler:()=>Ho});var Ho=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.some((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.entries(e).some(([r,o])=>t({key:r,value:o})):null,qs=Ho,Ls=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r};var It={};m(It,{default:()=>$s});var Ms=([e,t])=>{if(typeof e!="number"||typeof t!="number")return null;let r=Math.max(1,Math.pow(10,t));return Math.ceil(e*r)/r},$s=Ms;var _t={};m(_t,{default:()=>Hs});var xo=R(D()),Us=([e])=>!(0,xo.toBoolean)(e),Hs=Us;var Lt={};m(Lt,{default:()=>Bs});var qt=R(D()),xs=([e,t,r])=>{if(!(0,qt.isDefined)(navigator.canShare))return!1;let o=a=>(0,qt.isDefined)(a)&&typeof a=="string";if(!o(e)&&!o(t)&&!o(r))return!1;let n={};return o(t)&&(n.title=t),o(r)&&(n.text=r),o(e)&&(n.url=e),navigator.canShare(n)},Bs=xs;var Mt={};m(Mt,{default:()=>Ks});var Vs=([e])=>typeof e!="string"?null:decodeURIComponent(e),Ks=Vs;var $t={};m($t,{default:()=>Js});var Bo=R(D()),Vo=([e,t,r],o)=>{if(typeof t!="string"&&typeof t!="number"&&!Array.isArray(t))return null;let[n,...a]=Array.isArray(t)?t:[t];if((0,Bo.isObject)(e)){let s=Array.isArray(e)?[...e]:{...e};return s[n]=a.length===0?r:Vo([s[n],a,r],o),s}return null},Js=Vo;var Ut={};m(Ut,{default:()=>Gs});var Ws=([e,t])=>e>t,Gs=Ws;var Ht={};m(Ht,{default:()=>zs});var Qs=([e])=>{if(Array.isArray(e)){let t={};for(let{key:r,value:o}of e)t[r]=o;return t}return null},zs=Qs;var xt={};m(xt,{default:()=>Zs,getArgumentInputData:()=>Ys,handler:()=>Ko});var Ko=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.filter((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).filter(([r,o])=>t({key:r,value:o}))):Array.isArray(e)?e.filter((r,o)=>t({item:r,index:o})):null,Zs=Ko,Ys=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{value:o[1],key:o[0]}}}return r};var Bt={};m(Bt,{default:()=>Xs,getArgumentInputData:()=>ei,handler:()=>Jo});var Jo=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.find((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.entries(e).find(([r,o])=>t({key:r,value:o}))?.[1]:null,Xs=Jo,ei=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r};var Vt={};m(Vt,{default:()=>ri});var ti=([e,t])=>{if(typeof e!="string")return null;try{let{hostname:r,searchParams:o,pathname:n,hash:a,href:s,protocol:l,port:u,origin:f}=new URL(e,typeof t=="string"?t:void 0);return{hostname:r,searchParams:Object.fromEntries(o),path:n.split("/").filter((A,i)=>i!==0||A!==""),hash:a.replace("#",""),href:s,protocol:l,port:u,origin:f}}catch{return null}},ri=ti;var Kt={};m(Kt,{default:()=>ni});var oi=([e,t])=>typeof t!="number"||isNaN(t)?null:Array.isArray(e)?e.slice(t):typeof e=="string"?e.substring(t):null,ni=oi;var Jt={};m(Jt,{default:()=>si});var ai=([e])=>typeof e=="string"||Array.isArray(e)?e[e.length-1]:null,si=ai;var Wt={};m(Wt,{default:()=>li});var ii=([e,t,r])=>typeof e!="number"||typeof t!="number"||typeof r!="number"?null:Math.min(Math.max(e,t),r),li=ii;var Gt={};m(Gt,{default:()=>ci});var ui=(e,{env:t})=>t.isServer?t.request.url:window?.location.href??null,ci=ui;var Qt={};m(Qt,{default:()=>pi,getArgumentInputData:()=>fi});var di=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.map((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([r,o])=>{let n=t({key:r,value:o});return"key"in n&&"value"in n?[n.key,n.value]:null})):null,fi=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r},pi=di;var zt={};m(zt,{default:()=>gi});var mi=([e,t])=>isNaN(Number(e))||isNaN(Number(t))?null:Number(e)%Number(t),gi=mi;var Zt={};m(Zt,{default:()=>yi});var hi=([e],{root:t})=>typeof e!="string"?null:t.getElementById(e),yi=hi;var Yt={};m(Yt,{default:()=>Ai});var bi=([e,t,r])=>typeof e!="string"||typeof t!="string"?null:e.replaceAll(t,String(r)),Ai=bi;var Xt={};m(Xt,{default:()=>vi,getArgumentInputData:()=>wi,handler:()=>Wo});var Wo=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.findIndex((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.entries(e).findIndex(([r,o])=>t({key:r,value:o})):null,vi=Wo,wi=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r};var er={};m(er,{default:()=>Ci});var Si=(e,t)=>t.env.branchName,Ci=Si;var tr={};m(tr,{default:()=>Oi});var Ei=([e])=>typeof e!="string"?null:atob(e),Oi=Ei;var rr={};m(rr,{default:()=>Ri});var ji=([e])=>String(e),Ri=ji;var or={};m(or,{default:()=>Ti});var Go=R(D()),Fi=e=>{if(e.every(Array.isArray)){let t=[];for(let r of e)t.push(...r);return t}return e.every(Go.isObject)?Object.assign({},...e):e.join("")},Ti=Fi;var nr={};m(nr,{default:()=>ki});var Ni=([e,t])=>typeof t!="number"?null:JSON.stringify(e,null,t),ki=Ni;var ar={};m(ar,{default:()=>Pi});var Di=([e])=>{if(typeof e!="string"||e.length===0||typeof window>"u")return null;let t=window.sessionStorage.getItem(e);if(t===null)return t;try{return JSON.parse(t)}catch{return t}},Pi=Di;var sr={};m(sr,{default:()=>_i});var Ii=([e,t])=>globalThis.toddle.isEqual(e,t),_i=Ii;var ir={};m(ir,{default:()=>Li});var qi=([e])=>{if(!Array.isArray(e))return null;let t=new Set;return e.filter(r=>{let o=typeof r=="object"?JSON.stringify(r):r;return t.has(o)?!1:(t.add(o),!0)})},Li=qi;var lr={};m(lr,{default:()=>$i});var Mi=([e])=>Array.isArray(e)?[...e].reverse():null,$i=Mi;var ur={};m(ur,{default:()=>Hi});var Ui=([e])=>typeof e=="string"||Array.isArray(e)?e[0]:null,Hi=Ui;var cr={};m(cr,{default:()=>Bi});var xi=([e,t])=>{let r=Number(e),o=Number(t);return isNaN(r)||isNaN(o)?null:r-o},Bi=xi;var dr={};m(dr,{default:()=>Vi,getArgumentInputData:()=>Ki,handler:()=>Qo});var Qo=([e,t])=>{if(typeof t!="function"||!e||typeof e!="object"||!Array.isArray(e))return null;let r={};for(let o in e){let n=e[o],a=String(t({item:n,index:o}));r[a]=r[a]??[],r[a].push(n)}return r},Vi=Qo,Ki=([e],t,r)=>t===1&&Array.isArray(e)?{...r,Args:{item:e[0],index:0}}:r;var fr={};m(fr,{default:()=>Wi});var Ji=([e,t])=>{if(typeof e=="string")return e[Number(t)];let r=(o,n)=>{if(n.length===0)return o;let[a,...s]=n;return r(o?.[String(a)],s)};return r(e,Array.isArray(t)?t:[t])},Wi=Ji;var pr={};m(pr,{default:()=>Qi});var Gi=([e,t])=>Array.isArray(e)?[t,...e]:null,Qi=Gi;var mr={};m(mr,{default:()=>Zi});var zi=([e,t])=>isNaN(Number(e))||isNaN(Number(t))?null:Number(e)/Number(t),Zi=zi;var gr={};m(gr,{default:()=>Xi});var Yi=([e])=>typeof e=="string"?new Date(e):null,Xi=Yi;var hr={};m(hr,{default:()=>tl});var el=([e])=>{switch(typeof e){case"number":return isNaN(e)?null:"Number";case"string":return"String";case"boolean":return"Boolean";case"object":return Array.isArray(e)?"Array":e===null?"Null":"Object";case"undefined":return"Null";default:return null}},tl=el;var yr={};m(yr,{default:()=>ol});var rl=([e,t])=>typeof t!="number"?null:Array.isArray(e)?e.slice(e.length-t):typeof e=="string"?e.substring(e.length-t):null,ol=rl;var br={};m(br,{default:()=>al});var nl=([e])=>typeof e!="number"?null:Math.abs(e),al=nl;var Ar={};m(Ar,{default:()=>il});var sl=([e,t])=>typeof t!="number"||isNaN(t)?null:Array.isArray(e)?e.slice(0,e.length-t):typeof e=="string"?e.substring(0,e.length-t):null,il=sl;var vr={};m(vr,{default:()=>ul});var zo=R(D()),ll=([e,t])=>{if(typeof e!="object"||e===null||!Array.isArray(t)&&typeof t!="string"&&typeof t!="number")return null;let r=(n,[a,...s])=>{if(Array.isArray(n)){let l=Number(a);return Number.isNaN(l)?n:s.length===0?n.filter((u,f)=>f!==Number(a)):n.map((u,f)=>f===l?r(n[l],s):u)}return(0,zo.isObject)(n)?s.length===0?Object.fromEntries(Object.entries(n).filter(([l])=>l!==a)):{...n,[a]:r(n[a],s)}:null},o=Array.isArray(t)?t:[t];return r(e,o)},ul=ll;var wr={};m(wr,{default:()=>dl});var cl=([e])=>!e||!(e instanceof Date)?null:e.getTime(),dl=cl;var Sr={};m(Sr,{default:()=>pl});var fl=([e])=>typeof e=="object"&&e!==null?Object.entries(e).map(([t,r])=>({key:t,value:r})):null,pl=fl;var Cr={};m(Cr,{default:()=>gl});var ml=([e])=>typeof e!="string"?null:e.trim(),gl=ml;var Er={};m(Er,{default:()=>yl});var hl=([e])=>Array.isArray(e)?e.flat():null,yl=hl;var Or={};m(Or,{default:()=>Al});var bl=([e,t])=>{let r=isNaN(Number(t))?0:Number(t);return JSON.stringify(e,null,r)},Al=bl;var jr={};m(jr,{default:()=>wl});var vl=([e,t])=>e<=t,wl=vl;var Rr={};m(Rr,{default:()=>Cl});var Sl=()=>new Date,Cl=Sl;var Fr={};m(Fr,{default:()=>Ol});var El=([e])=>typeof e!="number"?null:Math.sqrt(e),Ol=El;var Tr={};m(Tr,{default:()=>Rl});var jl=([e,t])=>typeof t!="number"?null:Array.isArray(e)?e.slice(0,t):typeof e=="string"?e.substring(0,t):null,Rl=jl;var Nr={};m(Nr,{default:()=>Tl});var Fl=([e,t])=>Array.isArray(e)?[...e,t]:null,Tl=Fl;var kr={};m(kr,{default:()=>kl});var Nl=([e])=>{if(typeof e!="string"||e.length===0||typeof window>"u")return null;let t=window.localStorage.getItem(e);if(t===null)return t;try{return JSON.parse(t)}catch{return t}},kl=Nl;var Dr={};m(Dr,{default:()=>Pl});var Dl=([e])=>Number(e),Pl=Dl;var Pr={};m(Pr,{default:()=>_l});var Il=([e])=>typeof e!="string"?null:btoa(e),_l=Il;var Ir={};m(Ir,{default:()=>Ll});var ql=([e,t])=>Array.isArray(e)?e.join(String(t)):null,Ll=ql;var _r={};m(_r,{default:()=>$l});var Ml=([e,t])=>typeof e!="number"||typeof t!="number"?null:e>t?[]:Array.from({length:t-e+1},(r,o)=>o+e),$l=Ml;var qr={};m(qr,{default:()=>Hl});var Ul=e=>Math.max(...e.map(Number)),Hl=Ul;var Lr={};m(Lr,{default:()=>Bl});var xl=([e,t])=>e<t,Bl=xl;var Mr={};m(Mr,{default:()=>Kl});var Vl=([e])=>Array.isArray(e)?Zo(e):typeof e=="string"?Zo(e.split("")).join(""):null;function Zo(e){let t=[...e];for(let r=t.length-1;r>0;r--){let o=Math.floor(Math.random()*(r+1));[t[r],t[o]]=[t[o],t[r]]}return t}var Kl=Vl;var $r={};m($r,{default:()=>Wl});var Jl=([e,t])=>typeof e=="string"?e.lastIndexOf(t):Array.isArray(e)?e.findLastIndex(r=>globalThis.toddle.isEqual(r,t)):null,Wl=Jl;var Ur={};m(Ur,{default:()=>Ql});var Gl=([e,t])=>isNaN(Number(e))||isNaN(Number(t))?null:Number(e)**Number(t),Ql=Gl;var Hr={};m(Hr,{default:()=>Zl});var zl=([e,t])=>{if(typeof e!="number"||typeof t!="number")return null;let r=Math.max(1,Math.pow(10,t));return Math.floor(e*r)/r},Zl=zl;var xr={};m(xr,{default:()=>Yl,getArgumentInputData:()=>Xl,handler:()=>Yo});var Yo=([e,t])=>typeof t!="function"?null:Array.isArray(e)?e.every((r,o)=>t({item:r,index:o})):e&&typeof e=="object"?Object.entries(e).every(([r,o])=>t({key:r,value:o})):null,Yl=Yo,Xl=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{key:o[0],value:o[1]}}}return r};var Br={};m(Br,{default:()=>eu,getArgumentInputData:()=>tu,handler:()=>Xo});var Xo=([e,t])=>{if(typeof t!="function"||!e||typeof e!="object")return null;let r=Array.isArray(e)?e:Object.entries(e),o={};for(let n=0;n<r.length;n++){let a=r[n],s=String(t({item:a,i:n}));o[s]=a}return o},eu=Xo,tu=([e],t,r)=>{if(t===0)return r;if(Array.isArray(e))return{...r,Args:{item:e[0],index:0}};if(e&&typeof e=="object"){let[o]=Object.entries(e);if(o)return{...r,Args:{value:o[1],key:o[0]}}}return r};var Jr={};m(Jr,{default:()=>au});var en=R(Kr()),nu=([e])=>{if(typeof e!="string")return null;try{return(0,en.parseJSONWithDate)(e)}catch{return null}},au=nu;var Wr={};m(Wr,{default:()=>iu});var su=([e,t,r])=>{if(!e||!(e instanceof Date))return null;let o=typeof t=="string"&&t.length>0||Array.isArray(t)&&t.every(w=>typeof w=="string")?t:void 0;if(!r||typeof r!="object")return Intl.DateTimeFormat(o).format(e);let n=(w,d)=>typeof w=="string"&&(d?.includes(w)??!0)?w:void 0,a=r,s=n(a.dateStyle,["full","long","medium","short"]),l=n(a.timeStyle,["full","long","medium","short"]),u=n(a.calendar),f=n(a.weekday,["long","short","narrow"]),A=n(a.era,["long","short","narrow"]),i=n(a.year,["numeric","2-digit"]),p=n(a.month,["long","short","narrow","numeric","2-digit"]),b=n(a.day,["numeric","2-digit"]),O=n(a.hour,["numeric","2-digit"]),g=n(a.minute,["numeric","2-digit"]),C=n(a.second,["numeric","2-digit"]),h=n(a.timeZoneName,["long","short","shortOffset","longOffset","shortGeneric","longGeneric"]),E=n(a.timeZone),j=a.hour12===!0?!0:a.hour12===!1?!1:void 0;return Intl.DateTimeFormat(o,{dateStyle:s,timeStyle:l,calendar:u,weekday:f,era:A,year:i,month:p,day:b,hour:O,minute:g,second:C,timeZoneName:h,timeZone:E,hour12:j}).format(e)},iu=su;var Gr={};m(Gr,{default:()=>uu});var Te=R(D()),lu=([e,t,r,o,n])=>{if(typeof e!="string"||typeof t!="string")return[];let a=[(0,Te.toBoolean)(r)?"g":"",(0,Te.toBoolean)(o)?"i":"",(0,Te.toBoolean)(n)?"m":""].join(""),s=new RegExp(t,a);return e.match(s)??[]},uu=lu;var Qr={};m(Qr,{default:()=>du});var cu=([e])=>{if(Array.isArray(e)){let t=0;for(let r of e){if(isNaN(r)||typeof r!="number")return null;t+=r}return t}return null},du=cu;var zr={};m(zr,{default:()=>pu});var fu=([e,t])=>typeof e!="string"||typeof t!="string"?null:e.startsWith(t),pu=fu;var Zr={};m(Zr,{default:()=>gu});var mu=([e])=>typeof e=="number"?new Date(e):null,gu=mu;var Yr={};m(Yr,{default:()=>yu});var hu=(e,{env:t})=>t.isServer?t.request?.headers["accept-language"]?.split(",").map(r=>r.split(";")[0])??[]:window.navigator.languages,yu=hu;var Xr={};m(Xr,{default:()=>Au});var bu=([e,t])=>typeof e!="string"||typeof t!="string"?null:e.split(t),Au=bu;var eo={};m(eo,{default:()=>wu});var tn=R(D()),vu=([e])=>Array.isArray(e)?e.length:(0,tn.isObject)(e)?Object.keys(e).length:typeof e=="string"?e.length:null,wu=vu;var to={};m(to,{default:()=>Cu});var Su=(e,t)=>t.env.isServer,Cu=Su;var ro={};m(ro,{default:()=>Ou});var Eu=([e],{env:t,root:r})=>!e||typeof e!="string"?null:t.isServer?t.request.cookies[e]??null:r instanceof ShadowRoot?null:r.cookie.split("; ")?.find(o=>o.startsWith(`${e}=`))?.split("=")[1]??null,Ou=Eu;var oo={};m(oo,{default:()=>Ru});var rn=R(D()),ju=([e])=>(0,rn.toBoolean)(e),Ru=ju;var no={};m(no,{default:()=>Tu});var Fu=([e,t])=>typeof e=="string"?e.indexOf(t):Array.isArray(e)?e.findIndex(r=>globalThis.toddle.isEqual(r,t)):null,Tu=Fu;var ao={};m(ao,{default:()=>ku});var Nu=([e])=>typeof e!="string"?null:e.length===0?e:e[0].toLocaleUpperCase()+e.substring(1).toLocaleLowerCase(),ku=Nu;var so={};m(so,{default:()=>Pu});var Du=([e])=>typeof e!="string"?null:e.toLocaleLowerCase(),Pu=Du;var io={};m(io,{default:()=>Lu});var nn=R(on()),qu=([e])=>!e||typeof e!="string"?null:(0,nn.STRING_TEMPLATE)("cookies",e),Lu=qu;var lo={};m(lo,{default:()=>$u});var Mu=([e,t,r])=>{if(typeof e!="number"||Number.isNaN(e))return null;let o=typeof t=="string"&&t.length>0||Array.isArray(t)&&t.every(w=>typeof w=="string")?t:void 0;if(!r||typeof r!="object")return Intl.NumberFormat(o).format(e);let n=(w,d)=>typeof w=="string"&&(d?.includes(w)??!0)?w:void 0,a=r,s=n(a.style,["decimal","currency","percent","unit"]),l=typeof a.currency=="string"&&a.currency.length===3?a.currency:void 0;if(s==="currency"&&typeof l!="string")return null;let u=n(a.currencyDisplay,["code","symbol","narrowSymbol","name"]),f=typeof a.unit=="string"?a.unit:void 0;if(s==="unit"&&typeof f!="string")return null;let A=n(a.unitDisplay,["short","narrow","long"]),i=typeof a.minimumIntegerDigits=="number"&&a.minimumIntegerDigits>=1&&a.minimumIntegerDigits<=21?a.minimumIntegerDigits:void 0,p=typeof a.minimumFractionDigits=="number"&&a.minimumFractionDigits>=0&&a.minimumFractionDigits<=100?a.minimumFractionDigits:void 0,b=typeof a.maximumFractionDigits=="number"&&a.maximumFractionDigits>=0&&a.maximumFractionDigits<=100?a.maximumFractionDigits:void 0,O=typeof a.minimumSignificantDigits=="number"&&a.minimumSignificantDigits>=1&&a.minimumSignificantDigits<=21?a.minimumSignificantDigits:void 0,g=typeof a.maximumSignificantDigits=="number"&&a.maximumSignificantDigits>=1&&a.maximumSignificantDigits<=21?a.maximumSignificantDigits:void 0,C=n(a.notation,["standard","scientific","engineering","compact"]),h=n(a.compactDisplay,["short","long"]),E=["always","auto","min2"],j=typeof a.useGrouping=="boolean"?a.useGrouping:n(a.useGrouping,E);return new Intl.NumberFormat(o,{style:s,currency:l,currencyDisplay:u,unit:f,unitDisplay:A,minimumIntegerDigits:i,minimumFractionDigits:p,maximumFractionDigits:b,minimumSignificantDigits:O,maximumSignificantDigits:g,notation:C,compactDisplay:h,useGrouping:j}).format(e)},$u=Mu;var uo={};m(uo,{default:()=>Hu});var Uu=e=>!Array.isArray(e)||e.some(t=>t===null||typeof t!="number")?null:e.reduce((t,r)=>t+Number(r),0),Hu=Uu;var co={};m(co,{default:()=>Bu});var xu=([e,t])=>e>=t,Bu=xu;var kn=R(ke());function Vu(e){for(var t=[],r=0;r<e.length;){var o=e[r];if(o==="*"||o==="+"||o==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(o==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(o==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(o==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(o===":"){for(var n="",a=r+1;a<e.length;){var s=e.charCodeAt(a);if(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||s===95){n+=e[a++];continue}break}if(!n)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:n}),r=a;continue}if(o==="("){var l=1,u="",a=r+1;if(e[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<e.length;){if(e[a]==="\\"){u+=e[a++]+e[a++];continue}if(e[a]===")"){if(l--,l===0){a++;break}}else if(e[a]==="("&&(l++,e[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));u+=e[a++]}if(l)throw new TypeError("Unbalanced pattern at ".concat(r));if(!u)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:u}),r=a;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function sn(e,t){t===void 0&&(t={});for(var r=Vu(e),o=t.prefixes,n=o===void 0?"./":o,a=t.delimiter,s=a===void 0?"/#?":a,l=[],u=0,f=0,A="",i=function(y){if(f<r.length&&r[f].type===y)return r[f++].value},p=function(y){var F=i(y);if(F!==void 0)return F;var k=r[f],q=k.type,P=k.index;throw new TypeError("Unexpected ".concat(q," at ").concat(P,", expected ").concat(y))},b=function(){for(var y="",F;F=i("CHAR")||i("ESCAPED_CHAR");)y+=F;return y},O=function(y){for(var F=0,k=s;F<k.length;F++){var q=k[F];if(y.indexOf(q)>-1)return!0}return!1},g=function(y){var F=l[l.length-1],k=y||(F&&typeof F=="string"?F:"");if(F&&!k)throw new TypeError('Must have text between two parameters, missing text after "'.concat(F.name,'"'));return!k||O(k)?"[^".concat(oe(s),"]+?"):"(?:(?!".concat(oe(k),")[^").concat(oe(s),"])+?")};f<r.length;){var C=i("CHAR"),h=i("NAME"),E=i("PATTERN");if(h||E){var j=C||"";n.indexOf(j)===-1&&(A+=j,j=""),A&&(l.push(A),A=""),l.push({name:h||u++,prefix:j,suffix:"",pattern:E||g(j),modifier:i("MODIFIER")||""});continue}var w=C||i("ESCAPED_CHAR");if(w){A+=w;continue}A&&(l.push(A),A="");var d=i("OPEN");if(d){var j=b(),c=i("NAME")||"",S=i("PATTERN")||"",v=b();p("CLOSE"),l.push({name:c||(S?u++:""),pattern:c&&!S?g(j):S,prefix:j,suffix:v,modifier:i("MODIFIER")||""});continue}p("END")}return l}function ln(e,t){return Ku(sn(e,t),t)}function Ku(e,t){t===void 0&&(t={});var r=po(t),o=t.encode,n=o===void 0?function(u){return u}:o,a=t.validate,s=a===void 0?!0:a,l=e.map(function(u){if(typeof u=="object")return new RegExp("^(?:".concat(u.pattern,")$"),r)});return function(u){for(var f="",A=0;A<e.length;A++){var i=e[A];if(typeof i=="string"){f+=i;continue}var p=u?u[i.name]:void 0,b=i.modifier==="?"||i.modifier==="*",O=i.modifier==="*"||i.modifier==="+";if(Array.isArray(p)){if(!O)throw new TypeError('Expected "'.concat(i.name,'" to not repeat, but got an array'));if(p.length===0){if(b)continue;throw new TypeError('Expected "'.concat(i.name,'" to not be empty'))}for(var g=0;g<p.length;g++){var C=n(p[g],i);if(s&&!l[A].test(C))throw new TypeError('Expected all "'.concat(i.name,'" to match "').concat(i.pattern,'", but got "').concat(C,'"'));f+=i.prefix+C+i.suffix}continue}if(typeof p=="string"||typeof p=="number"){var C=n(String(p),i);if(s&&!l[A].test(C))throw new TypeError('Expected "'.concat(i.name,'" to match "').concat(i.pattern,'", but got "').concat(C,'"'));f+=i.prefix+C+i.suffix;continue}if(!b){var h=O?"an array":"a string";throw new TypeError('Expected "'.concat(i.name,'" to be ').concat(h))}}return f}}function un(e,t){var r=[],o=cn(e,r,t);return Ju(o,r,t)}function Ju(e,t,r){r===void 0&&(r={});var o=r.decode,n=o===void 0?function(a){return a}:o;return function(a){var s=e.exec(a);if(!s)return!1;for(var l=s[0],u=s.index,f=Object.create(null),A=function(p){if(s[p]===void 0)return"continue";var b=t[p-1];b.modifier==="*"||b.modifier==="+"?f[b.name]=s[p].split(b.prefix+b.suffix).map(function(O){return n(O,b)}):f[b.name]=n(s[p],b)},i=1;i<s.length;i++)A(i);return{path:l,index:u,params:f}}}function oe(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function po(e){return e&&e.sensitive?"":"i"}function Wu(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,o=0,n=r.exec(e.source);n;)t.push({name:n[1]||o++,prefix:"",suffix:"",modifier:"",pattern:""}),n=r.exec(e.source);return e}function Gu(e,t,r){var o=e.map(function(n){return cn(n,t,r).source});return new RegExp("(?:".concat(o.join("|"),")"),po(r))}function Qu(e,t,r){return zu(sn(e,r),t,r)}function zu(e,t,r){r===void 0&&(r={});for(var o=r.strict,n=o===void 0?!1:o,a=r.start,s=a===void 0?!0:a,l=r.end,u=l===void 0?!0:l,f=r.encode,A=f===void 0?function(F){return F}:f,i=r.delimiter,p=i===void 0?"/#?":i,b=r.endsWith,O=b===void 0?"":b,g="[".concat(oe(O),"]|$"),C="[".concat(oe(p),"]"),h=s?"^":"",E=0,j=e;E<j.length;E++){var w=j[E];if(typeof w=="string")h+=oe(A(w));else{var d=oe(A(w.prefix)),c=oe(A(w.suffix));if(w.pattern)if(t&&t.push(w),d||c)if(w.modifier==="+"||w.modifier==="*"){var S=w.modifier==="*"?"?":"";h+="(?:".concat(d,"((?:").concat(w.pattern,")(?:").concat(c).concat(d,"(?:").concat(w.pattern,"))*)").concat(c,")").concat(S)}else h+="(?:".concat(d,"(").concat(w.pattern,")").concat(c,")").concat(w.modifier);else{if(w.modifier==="+"||w.modifier==="*")throw new TypeError('Can not repeat "'.concat(w.name,'" without a prefix and suffix'));h+="(".concat(w.pattern,")").concat(w.modifier)}else h+="(?:".concat(d).concat(c,")").concat(w.modifier)}}if(u)n||(h+="".concat(C,"?")),h+=r.endsWith?"(?=".concat(g,")"):"$";else{var v=e[e.length-1],y=typeof v=="string"?C.indexOf(v[v.length-1])>-1:v===void 0;n||(h+="(?:".concat(C,"(?=").concat(g,"))?")),y||(h+="(?=".concat(C,"|").concat(g,")"))}return new RegExp(h,po(r))}function cn(e,t,r){return e instanceof RegExp?Wu(e,t):Array.isArray(e)?Gu(e,t,r):Qu(e,t,r)}var B=R(U()),dn=R(z()),mo=R(Kr());var K=R(U()),ce=R(z()),he=R(D());function I(e,t,r,o){try{if(!e)throw new Error("Action does not exist");switch(e.type){case"Switch":{let n=e.cases.find(({condition:a})=>(0,he.toBoolean)((0,K.applyFormula)(a,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env})))??e.default;if(!n)return;for(let a of n.actions)I(a,{...t,...r.dataSignal.get()},r,o);break}case"SetVariable":{let n=(0,K.applyFormula)(e.data,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env});r.dataSignal.update(a=>({...a,Variables:{...a.Variables,[e.variable]:n}}));break}case"TriggerEvent":{let n=(0,K.applyFormula)(e.data,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env});r.triggerEvent(e.event,n);break}case"SetURLParameter":{r.toddle.locationSignal.update(n=>{let a=(0,K.applyFormula)(e.data,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env});return n.route?.path.some(s=>s.name===e.parameter)?{...n,params:{...(0,ce.omitKeys)(n.params,[e.parameter]),[e.parameter]:a}}:{...n,query:{...(0,ce.omitKeys)(n.query,[e.parameter]),...(0,he.isDefined)(a)?{[e.parameter]:a}:null}}});break}case"Fetch":{let n=r.apis[e.api];if(!n){console.error("The api ",e.api,"does not exist");return}let a=r.component.apis?.[e.api]?.version===2,s=a?(0,ce.mapValues)(e.inputs??{},f=>(0,K.applyFormula)(f.formula,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env})):void 0,l=a?{onCompleted:e.onSuccess?.actions,onFailed:e.onError?.actions,onMessage:e.onMessage?.actions}:void 0,u=f=>{if(!a)for(let A of f)I(A,{...t,...r.dataSignal.get()},r,o)};n.fetch({actionInputs:s,actionModels:l}).then(()=>{u(e.onSuccess.actions)},()=>{u(e.onError.actions)});break}case"TriggerWorkflow":{let n=(0,ce.mapValues)(e.parameters??{},s=>(0,K.applyFormula)(s.formula,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env}));if(e.contextProvider){let s=r.providers[[r.package,e.contextProvider].filter(he.isDefined).join("/")]??r.providers[e.contextProvider],l=s?.component.workflows?.[e.workflow];if(!l){s&&console.warn(`Cannot find workflow "${e.workflow}" on component "${e.contextProvider}". It has likely been removed or modified.`);return}l.actions.forEach(u=>I(u,{...t,...s.ctx.dataSignal.get(),Parameters:n},s.ctx,o));return}let a=r.component.workflows?.[e.workflow];if(!a){console.warn(`Workflow ${e.workflow} does not exist on component ${r.component.name}`);return}a.actions.forEach(s=>I(s,{...t,...r.dataSignal.get(),Parameters:n},r,o));break}default:try{let n=(s,l)=>{let u=e.events?.[s];u&&u.actions.forEach(f=>I(f,l?{...t,...r.dataSignal.get(),Event:l}:{...t,...r.dataSignal.get()},r,l??o))},a=e.version===2?(r.toddle.getCustomAction??r.toddle.getCustomAction)(e.name,e.package??r.package):void 0;if(a){let s=(e.arguments??[]).reduce((u,f)=>({...u,[f.name]:(0,K.applyFormula)(f.formula,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env})}),{}),l=a.handler?.(s,{root:r.root,triggerActionEvent:n},o);return l&&(typeof l=="function"||l instanceof Promise)&&r.dataSignal.subscribe(u=>u,{destroy:()=>{l instanceof Promise?l.then(u=>{typeof u=="function"&&u()}).catch(u=>console.error(u)):l()}}),l}else{let s=r.toddle.getAction(e.name);if(!s){console.error("Missing custom action",e.name);return}let l=e.arguments?.map(u=>(0,K.applyFormula)(u.formula,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env}))??[(0,K.applyFormula)(e.data,{data:t,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env})];return s(l,{...r,triggerActionEvent:n},o)}}catch(n){console.error("Error in Custom Action",n)}}}catch(n){return console.error(n),null}}function De(e,t){let r=null;function o(i,p){let b={data:p,component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env},O=(0,B.applyFormula)(i.url,b)??"",g=i.path&&i.path.length>0?"/"+i.path.map(c=>(0,B.applyFormula)(c.formula,b)).join("/"):"",C=Object.values(i.queryParams??{}),h=C.length>0?"?"+C.map(c=>`${c.name}=${encodeURIComponent((0,B.applyFormula)(c.formula,b))}`).join("&"):"",E=(0,B.isFormula)(i.headers)?(0,B.applyFormula)(i.headers,{data:p,component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env}):(0,dn.mapValues)(i.headers??{},c=>(0,B.applyFormula)(c,{data:p,component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env})),j=String(Object.entries(E).find(([c])=>c.toLocaleLowerCase()==="content-type")?.[1]),w=i.method??"GET",d=i.body&&["POST","PUT","PATCH","DELETE"].includes(w)?a((0,B.applyFormula)(i.body,{data:p,component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env}),j):void 0;return{url:O+g+h,method:w,auth:i.auth,headers:E,body:d}}async function n(i){let p=await i.text();try{return(0,mo.parseJSONWithDate)(p)}catch{return p}}function a(i,p){switch(p){case"application/x-www-form-urlencoded":return typeof i=="object"&&i!==null?Object.entries(i).map(([b,O])=>Array.isArray(O)?O.map(g=>`${encodeURIComponent(b)}=${encodeURIComponent(g)}`).join("&"):`${encodeURIComponent(b)}=${encodeURIComponent(String(O))}`).join("&"):"";case"multipart/form-data":{let b=new FormData;return typeof i=="object"&&i!==null&&Object.entries(i).forEach(([O,g])=>{b.set(O,g)}),b}case"text/plain":return String(i);default:return JSON.stringify(i)}}function s(i){t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[e.name]:{data:i,error:null,isLoading:!1}}}),e.onCompleted?.actions?.forEach(p=>{I(p,t.dataSignal.get(),t)})}function l(i){t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[e.name]:{data:null,isLoading:!1,error:i}}}),e.onFailed?.actions?.forEach(p=>{I(p,t.dataSignal.get(),t)})}async function u(i){t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[e.name]:{data:t.dataSignal.get().Apis?.[e.name]?.data??null,isLoading:!0,error:null}}});let p;try{e.proxy===!1?p=await fetch(i.url,{method:i.method,headers:i.headers,body:i.body}):p=await fetch(`/_query/${encodeURIComponent(t.component.name)}.${encodeURIComponent(e.name)}`,{method:"POST",body:JSON.stringify(i),signal:t.abortSignal,headers:{"Content-Type":"application/json"}});let b=await n(p);if(p.ok)s(b);else throw b}catch(b){return l(b),Promise.reject(b)}}function f(i){return typeof e.debounce=="number"?new Promise((p,b)=>{typeof r=="number"&&clearTimeout(r),r=setTimeout(()=>{u(i).then(p,b)},e.debounce)}):typeof e.throttle=="number"?typeof r=="number"?new Promise(()=>{}):(r=setTimeout(()=>{typeof r=="number"&&clearTimeout(r)},e.throttle),u(i)):u(i)}let A;if(t.dataSignal.update(i=>({...i,Apis:{...i.Apis??{},[e.name]:i.Apis?.[e.name]??{data:null,isLoading:!!(e.autoFetch&&(0,B.applyFormula)(e.autoFetch,{data:t.dataSignal.get(),component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env})),error:null}}})),e.autoFetch){A=t.dataSignal.map(p=>o(e,p));let i=!0;A.subscribe(p=>{if(e.autoFetch&&(0,B.applyFormula)(e.autoFetch,{data:t.dataSignal.get(),component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env}))if(i&&t.isRootComponent){i=!1;let b=t.toddle?.pageState?.Apis?.[e.name];b&&b.data?typeof b.data=="string"?s((0,mo.parseJSONWithDate)(b.data)):s(b.data):f(p)}else f(p)})}return{fetch:i=>{let p=o(e,t.dataSignal.get()),b=p.body,O=new Headers({...p.headers,...i?.headers??{}});i?.body&&(b=a(i.body,O.get("Content-Type")??void 0)),b instanceof FormData&&O.delete("Content-Type");let g={url:i?.url??p.url,method:i?.method??p.method,auth:i?.auth??p.auth,headers:[...O.entries()].reduce((C,[h,E])=>({...C,[h]:E}),{}),body:b};return f(g)},destroy:()=>A?.destroy()}}var W=R(Fe()),G=R(fn()),J=R(U()),Pe=R(z()),Ie=R(pn());function _e(e,t){let r=null,o={...e};function n(d){let c=window.origin;try{new URL(c)}catch{c=void 0}return(0,W.createApiRequest)({api:d,formulaContext:a(d),baseUrl:c,defaultHeaders:void 0})}function a(d){let c={data:t.dataSignal.get(),component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,toddle:t.toddle,env:t.env},S=Object.entries(d.inputs).reduce((y,[F,k])=>(y[F]=(0,J.applyFormula)(k.formula,c),y),{}),v={...c.data,ApiInputs:{...S}};return{component:t.component,formulaCache:t.formulaCache,root:t.root,package:t.package,data:v,toddle:t.toddle,env:t.env}}function s(d){for(let[c,S]of(0,Pe.sortObjectEntries)(d.redirectRules??{},([v,y])=>y.index)){let v=(0,J.applyFormula)(S.formula,{...a(d),data:{...a(d).data,Apis:{[d.name]:t.dataSignal.get().Apis?.[d.name]}}});if(typeof v=="string"){let y=(0,Ie.validateUrl)(v,window.location.href);if(y){if(t.env.runtime==="preview")return window.parent?.postMessage({type:"blockedNavigation",url:y.href},"*"),{name:c,index:S.index,url:y};window.location.replace(y.href)}}}}function l(d,c,S){switch(d){case"message":{let v=(0,W.createApiEvent)("message",S.body);c.client?.onMessage?.actions?.forEach(y=>{I(y,{...a(c).data,...t.dataSignal.get(),Event:v},t,v)});break}case"success":{let v=(0,W.createApiEvent)("success",S.body);c.client?.onCompleted?.actions?.forEach(y=>{I(y,{...a(c).data,...t.dataSignal.get(),Event:v},t,v)});break}case"failed":{let v=(0,W.createApiEvent)("failed",{error:S.body,status:S.status});c.client?.onFailed?.actions?.forEach(y=>{I(y,{...a(c).data,...t.dataSignal.get(),Event:v},t,v)});break}}}function u(d,c,S){let v=t.dataSignal.get().Apis?.[d.name]?.response?.performance?.requestStart;if(typeof v=="number"&&v>(S.requestStart??0))return;t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!1,data:c.body,error:null,response:{status:c.status,headers:c.headers,performance:S}}}});let y=s(d);y&&t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!1,data:c.body,error:null,response:{status:c.status,headers:c.headers,performance:S,...t.env.runtime==="preview"?{debug:{appliedRedirectRule:y}}:{}}}}})}function f(d,c,S){let v=t.dataSignal.get().Apis?.[d.name]?.response?.performance?.requestStart;if(typeof v=="number"&&v>(S.requestStart??0))return;t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!1,data:null,error:c.body,response:{status:c.status,headers:c.headers,performance:S}}}});let y=s(d);y&&t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!1,data:null,error:c.body,response:{status:c.status,headers:c.headers,performance:S,...t.env.runtime==="preview"?{debug:{appliedRedirectRule:y}}:{}}}}})}async function A(d,c,S){let v=async()=>{let y={requestStart:Date.now(),responseStart:null,responseEnd:null};t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!0,data:t.dataSignal.get().Apis?.[d.name]?.data??null,error:null}}});let F;try{if((d.server?.proxy?(0,J.applyFormula)(d.server.proxy.enabled.formula,a(d))??!1:!1)===!1)F=await fetch(c,S);else{let q=`/.toddle/omvej/components/${encodeURIComponent(t.component.name)}/apis/${encodeURIComponent(t.component.name)}:${encodeURIComponent(d.name)}`,P=new Headers(S.headers);P.set(Ie.PROXY_URL_HEADER,decodeURIComponent(c.href.replace(/\+/g," "))),S.headers=P,F=await fetch(q,S)}y.responseStart=Date.now(),await i(d,F,y);return}catch(k){let q=k.cause?{message:k.message,data:k.cause}:k.message;return f(d,{body:q},{...y,responseEnd:Date.now()}),l("failed",d,{body:q}),Promise.reject(k)}};return d.client?.debounce?.formula?new Promise((y,F)=>{typeof r=="number"&&clearTimeout(r),r=setTimeout(()=>{v().then(y,F)},(0,J.applyFormula)(d.client?.debounce?.formula,a(d)))}):v()}function i(d,c,S){let v=d.client?.parserMode??"auto";if(v==="auto"){let y=c.headers.get("content-type");(0,G.isEventStreamHeader)(y)?v="event-stream":(0,G.isJsonHeader)(y)?v="json":(0,G.isTextHeader)(y)?v="text":(0,G.isJsonStreamHeader)(y)?v="json-stream":(0,G.isImageHeader)(y)?v="blob":v="text"}switch(v){case"text":return p(d,c,S);case"json":return O(d,c,S);case"event-stream":return C(d,c,S);case"json-stream":return b(d,c,S);case"blob":return g(d,c,S);default:return p(d,c,S)}}function p(d,c,S){return h({api:d,res:c,performance:S,streamType:"text",useTextDecoder:!0,parseChunk:v=>v,parseChunksForData:v=>v.join("")})}function b(d,c,S){return h({api:d,res:c,performance:S,streamType:"json",useTextDecoder:!0,parseChunk:y=>{let F=y;try{F=JSON.parse(y)}catch{throw new Error("Error occurred while parsing the json chunk.",{cause:F})}return F},parseChunksForData:y=>[...y],delimiters:[`\r
`,`
`]})}async function O(d,c,S){let y={data:await c.json(),isLoading:!1,error:null,response:{status:c.status,headers:Object.fromEntries(c.headers.entries())}};return E(d,y,S)}async function g(d,c,S){let v=await c.blob(),y={isLoading:!1,data:URL.createObjectURL(v),error:null,response:{status:c.status,headers:Object.fromEntries(c.headers.entries())}};return E(d,y,S)}function C(d,c,S){return h({api:d,res:c,performance:S,streamType:"event",useTextDecoder:!0,parseChunk:y=>{let F=y.match(/event: (.*)/)?.[1]??"message",k=y.match(/data: (.*)/)?.[1]??"",q=y.match(/id: (.*)/)?.[1],P=y.match(/retry: (.*)/)?.[1],me=k;try{me=JSON.parse(k??"")}catch{}return{event:F,data:me,...q?{id:q}:{},...P?{retry:P}:{}}},parseChunksForData:y=>[...y],delimiters:[`

`,`\r
\r
`]})}async function h({api:d,res:c,performance:S,streamType:v,useTextDecoder:y,parseChunk:F,parseChunksForData:k,delimiters:q}){let P={chunks:[],currentChunk:"",add(ee){let Q=F(ee);this.chunks.push(Q),Q&&(t.dataSignal.set({...t.dataSignal.get(),Apis:{...t.dataSignal.get().Apis,[d.name]:{isLoading:!0,data:k(this.chunks),error:null,response:{headers:Object.fromEntries(c.headers.entries())}}}}),(d.client?.onMessage?.actions??[]).length>0&&l("message",d,{body:Q}))},processChunk(ee){let Q=q?.find(Ge=>ee.includes(Ge)),So=this.currentChunk+ee,Co=Q?So.split(Q):[So];this.currentChunk=Co.pop()??"",Co.forEach(Ge=>this.add(Ge))}},me=y?c.body?.pipeThrough(new TextDecoderStream).getReader():c.body?.getReader();for(;me;){let{done:ee,value:Q}=await me.read();if(ee)break;q?P.processChunk(Q):P.add(Q)}P.currentChunk&&P.add(P.currentChunk);let ve={isLoading:!1,data:P.chunks,error:null,response:{status:c.status,headers:Object.fromEntries(c.headers.entries())}};try{if(v==="json"){let ee=JSON.parse(P.chunks.join(""));ve.data=ee}else v==="text"&&(ve.data=P.chunks.join(""))}catch{throw new Error("Error occurred while parsing the json chunk.",{cause:P.chunks.join("")})}return E(d,ve,S)}function E(d,c,S){S.responseEnd=Date.now();let v={body:c.data,status:c.response?.status,headers:c.response?.headers??void 0};(0,W.isApiError)({apiName:d.name,response:{body:v.body,ok:!!(!c.error&&c.response?.status&&c.response.status<400),status:v.status,headers:v.headers},formulaContext:a(d),errorFormula:d.isError,performance:S})?(!v.body&&c.error&&(v.body=c.error),f(d,v,S),l("failed",d,v)):(u(d,v,S),l("success",d,v))}function j(d){return(0,Pe.omitPaths)(d,[["client","onCompleted"],["client","onFailed"],["client","onMessage"],["service"],["server","ssr"]])}let w;return w=t.dataSignal.map(d=>{let c=a(o);return{request:n(o),api:j(o),autoFetch:o.autoFetch?(0,J.applyFormula)(o.autoFetch,c):!1,proxy:(0,J.applyFormula)(o.server?.proxy?.enabled.formula,c)}}),w.subscribe(async d=>{if(o.autoFetch&&(0,J.applyFormula)(o.autoFetch,a(o)))if((window?.__toddle?.isPageLoaded??!1)===!1){let{url:c,requestSettings:S}=n(o),v=(0,W.requestHash)(c,S),y=t.toddle.pageState.Apis?.[v];y?y.error?f(o,{body:y.error,status:y.response?.status,headers:y.response?.headers??void 0},{requestStart:y.response?.performance?.requestStart??null,responseStart:y.response?.performance?.responseStart??null,responseEnd:y.response?.performance?.responseEnd??null}):u(o,{body:y.data,status:y.response?.status,headers:y.response?.headers??void 0},{requestStart:y.response?.performance?.requestStart??null,responseStart:y.response?.performance?.responseStart??null,responseEnd:y.response?.performance?.responseEnd??null}):await A(o,c,S)}else{let{url:c,requestSettings:S}=n(o);await A(o,c,S)}else t.dataSignal.update(c=>({...c,Apis:{...c.Apis??{},[o.name]:{isLoading:!1,data:null,error:null}}}))}),{fetch:({actionInputs:d,actionModels:c})=>{let S=Object.entries(d??{}).reduce((k,[q,P])=>(P!==null&&typeof P=="object"&&"formula"in P?k[q]=P:k[q]={formula:{type:"value",value:P}},k),{}),v={...o,inputs:{...o.inputs,...S},client:{...o.client,parserMode:o.client?.parserMode??"auto",onCompleted:{trigger:o.client?.onCompleted?.trigger??"success",actions:[...o.client?.onCompleted?.actions??[],...c?.onCompleted??[]]},onFailed:{trigger:o.client?.onFailed?.trigger??"failed",actions:[...o.client?.onFailed?.actions??[],...c?.onFailed??[]]},onMessage:{trigger:o.client?.onMessage?.trigger??"message",actions:[...o.client?.onMessage?.actions??[],...c?.onMessage??[]]}}},{url:y,requestSettings:F}=n(v);return A(v,y,F)},update:d=>{o=d;let c=a(o),S=o.autoFetch&&(0,J.applyFormula)(o.autoFetch,c);S&&w?.set({request:n(d),api:j(d),autoFetch:S,proxy:(0,J.applyFormula)(d.server?.proxy?.enabled.formula,c)})},triggerActions:()=>{let d=t.dataSignal.get().Apis?.[o.name];d===void 0||d.data===null&&d.error===null||(d.error?l("failed",o,{body:d.error,status:d.response?.status}):l("success",o,{body:d.data}))},destroy:()=>w?.destroy()}}var Tn=R(ke());var qe=class{batchQueue=[];isProcessing=!1;processBatch(){this.isProcessing||(this.isProcessing=!0,requestAnimationFrame(()=>{for(;this.batchQueue.length>0;)this.batchQueue.shift()?.();this.isProcessing=!1}))}add(t){this.batchQueue.push(t),this.processBatch()}};var Je=R(U()),Fn=R(D());var ho=R(ke()),go=class{value;subscribers;subscriptions;constructor(t){this.value=t,this.subscribers=new Set,this.subscriptions=[]}get(){return this.value}set(t){if(this.subscribers.size===0){this.value=t;return}(0,ho.default)(t,this.value)===!1&&(this.value=t,this.subscribers.forEach(({notify:r})=>r(this.value)))}update(t){this.set(t(this.value))}subscribe(t,r){let o={notify:t,destroy:r?.destroy};return this.subscribers.add(o),t(this.value),()=>{this.subscribers.delete(o)}}destroy(){this.subscribers.forEach(({destroy:t})=>{t?.()}),this.subscribers.clear(),this.subscriptions?.forEach(t=>t())}cleanSubscribers(){this.subscribers.forEach(({destroy:t})=>{t?.()}),this.subscribers.clear()}map(t){let r=X(t(this.value));return r.subscriptions.push(this.subscribe(o=>r.set(t(o)),{destroy:()=>r.destroy()})),r}};function X(e){return new go(e)}typeof window<"u"&&(window.signal=X,window.deepEqual=ho.default);var yo=(e,t)=>{let o=e.split(".").slice(-1)[0],n=parseInt(o),a=parseInt(String(o.split("(")[1]));for(let s of t.children){let u=s.getAttribute("data-id")?.split(".").slice(-1)[0],f=parseInt(String(u));if(f===n&&parseInt(String(u?.split("(")[1]))>a||f>n)return s}return null};function mn(e,t,r=null){let o=r,n=o?o.previousSibling:e.lastChild;for(let a=t.length-1;a>=0;a--){let s=t[a];s===n?n=s.previousSibling:e.insertBefore(s,o),o=s}}var He=R(Fe()),be=R(U()),Ue=R(z()),An=R(D());var Le=e=>e.formulas&&Object.values(e.formulas).some(({exposeInContext:t})=>t)||e.workflows&&Object.values(e.workflows).some(({exposeInContext:t})=>t);var bo=R(U()),Me=R(z()),Ao=R(D());function gn(e,t,r){Object.entries(t.contexts??{}).forEach(([o,n])=>{let a=r.providers[[r.package,o].filter(Ao.isDefined).join("/")];if(a)n.formulas.forEach(s=>{let l=a.formulaDataSignals[s];if(!l){console.warn(`Provider ${o} does not expose a formula named "${s}". Available formulas are: ["${Object.keys(a.formulaDataSignals).join('", "')}"]`);return}l.subscribe(u=>{e.update(f=>({...f,Contexts:{...f.Contexts,[o]:{...f.Contexts?.[o],[s]:u}}}))})});else if(!a&&r.env.runtime==="preview"&&r.toddle._preview){let s=r.components?.find(f=>f.name===[r.package,o].filter(Ao.isDefined).join("/"));if(!s){console.error(`Could not find provider "${o}". No such component exist.`);return}let[,l]=o.split("/").reverse(),u={data:{Attributes:(0,Me.mapObject)(s.attributes,([f,A])=>[f,A.testValue])},component:s,root:r?.root,formulaCache:{},package:l??r?.package,toddle:r.toddle,env:r.env};s.route&&(u.data["URL parameters"]={...Object.fromEntries(s.route.path.filter(f=>f.type==="param").map(f=>[f.name,f.testValue])),...(0,Me.mapObject)(s.route.query,([f,{testValue:A}])=>[f,A])}),u.data.Variables=(0,Me.mapObject)(s.variables,([f,A])=>[f,(0,bo.applyFormula)(A.initialValue,u)]),e.update(f=>({...f,Contexts:{...f.Contexts,[o]:Object.fromEntries(n.formulas.map(A=>{let i=s.formulas?.[A];return i?[A,(0,bo.applyFormula)(i.formula,u)]:(console.warn(`Could not find formula "${A}" in component "${o}"`),[A,null])}))}}))}})}function hn(){window.logState=()=>{console.table(Object.entries(window.__components??{}).map(([e,t])=>({name:e,...t.get()})))}}function $e(e,t){window.__components||(window.__components={}),window.__components[e.name]=t}var ye=R(z()),yn=R(D());function bn(e){return(0,yn.isDefined)(e.formulas)?(0,ye.mapObject)(e.formulas,([t,r])=>{let{canCache:o,keys:n}=r.memoize?sc(r.formula,e):{canCache:!1,keys:[]},a,s;return[t,{get:l=>o&&a&&n.every(u=>(0,ye.get)(l,u)===(0,ye.get)(a,u))?{hit:!0,data:s}:{hit:!1},set:(l,u)=>{o&&(a=l,s=u)}}]}):{}}function sc(e,t){let r=[];function o(a){if(a&&(a.type=="path"&&a.path[0]!=="Args"&&r.push(a.path),Array.isArray(a?.arguments)&&a?.arguments.forEach(s=>o(s.formula)),a.type==="record"&&Array.isArray(a.entries)&&a.entries.forEach(s=>o(s.formula)),a.type==="apply")){if(!t.formulas?.[a.name]?.memoize)throw new Error("Cannot memoize");o(t.formulas?.[a.name]?.formula)}}try{o(e)}catch{return{canCache:!1,keys:[]}}let n=[];return r.sort((a,s)=>a.length-s.length).forEach(a=>{n.some(s=>s.every((l,u)=>l===a[u]))||n.push(a)}),{canCache:!0,keys:n}}function vn({node:e,path:t,dataSignal:r,ctx:o,parentElement:n,instance:a,namespace:s}){let l=[o.package,e.name].filter(An.isDefined).join("/"),u=o.components?.find(h=>h.name===l);if(!u)return console.warn(`Could not find component "${l}" for component "${o.component.name}". Available components are: ["${o.components.map(h=>h.name).join('", "')}"]`),[];let f=r.map(h=>(0,Ue.mapObject)(e.attrs,([E,j])=>[E,j?.type!=="value"?(0,be.applyFormula)(j,{data:h,component:o.component,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env}):j?.value])),A=X({Location:r.get().Location,Attributes:f.get(),Apis:(0,Ue.mapObject)(u.apis,([h,E])=>[h,{data:null,isLoading:!!(E.autoFetch&&(0,be.applyFormula)(E.autoFetch,{data:r.get(),component:u,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env})),error:null}])});gn(A,u,o),A.update(h=>({...h,Variables:(0,Ue.mapObject)(u.variables,([E,j])=>[E,(0,be.applyFormula)(j.initialValue,{data:A.get(),component:u,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env})])})),$e(u,A);let i=new AbortController;A.subscribe(()=>{},{destroy:()=>i.abort(`Component ${u.name} unmounted`)});let p=bn(u),b={};(0,He.sortApiObjects)(Object.entries(u.apis)).forEach(([h,E])=>{(0,He.isLegacyApi)(E)?b[h]=De(E,{...o,apis:b,component:u,dataSignal:A,abortSignal:i.signal,isRootComponent:!1,formulaCache:p,package:e.package??o.package,triggerEvent:(j,w)=>{let d=Object.values(e.events).find(c=>c.trigger===j);d&&d.actions.forEach(c=>I(c,{...r.get(),Event:w},o))}}):b[h]=_e(E,{...o,apis:b,component:u,dataSignal:A,abortSignal:i.signal,isRootComponent:!1,formulaCache:p,package:e.package??o.package,triggerEvent:(j,w)=>{let d=Object.values(e.events).find(c=>c.trigger===j);d&&d.actions.forEach(c=>I(c,{...r.get(),Event:w},o))}})}),Object.values(b).filter(h=>h.triggerActions!==void 0).forEach(h=>{h.triggerActions()});let O=(h,E)=>{let j=Object.values(e.events).find(w=>w.trigger===h);j&&j.actions.forEach(w=>I(w,{...r.get(),Event:E},o))},g=o.providers;if(Le(u)){let h=Object.fromEntries(Object.entries(u.formulas??{}).filter(([,E])=>E.exposeInContext).map(([E,j])=>[E,A.map(w=>(0,be.applyFormula)(j.formula,{data:w,component:u,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env}))]));g={...g,[u.name]:{component:u,formulaDataSignals:h,ctx:{...o,apis:b,component:u,dataSignal:A,abortSignal:i.signal,triggerEvent:O}}}}let C={};for(let h=0;h<e.children.length;h++){let E=e.children[h],w=o.component.nodes[E].slot??"default";C[w]=C[w]??[],C[w].push({id:E,path:`${t}.${h}[${w}]`,dataSignal:r,ctx:{...o,package:e.package??o.package}})}return f.subscribe(h=>A.update(E=>({...E,Attributes:h})),{destroy:()=>A.destroy()}),xe({dataSignal:A,component:u,components:o.components,path:t,root:o.root,isRootComponent:!1,children:C,formulaCache:p,providers:g,apis:b,abortSignal:i.signal,package:e.package??o.package,parentElement:n,onEvent:O,toddle:o.toddle,env:o.env,namespace:s,instance:e.id==="root"?{...a,[o.component.name]:"root"}:{[o.component.name]:e.id??""}})}var Ae=R(U()),Ve=R(Sn()),Ke=R(D());function Cn(e){if(e instanceof DragEvent)return Array.from(e.dataTransfer?.items??[]).reduce((t,r)=>(t[r.type]=e.dataTransfer?.getData(r.type),t),{})}function En(e,t,r){return t.component.version===2&&r==="root"?`${t.package??t.toddle.project}-${e.tag}`:e.tag}var fe=R(D());function vo(e,t,r){switch(t){case"srcObject":case"src":e instanceof HTMLMediaElement?e[t]=r:e.setAttribute(t,String(r));break;case"value":case"type":{let o=r;e instanceof HTMLProgressElement&&(!(0,fe.isDefined)(r)||!Number.isFinite(Number(r)))&&(o=0),e[t]=(0,fe.toBoolean)(o)?String(o):void 0;break}case"muted":case"autoplay":e instanceof HTMLMediaElement?e[t]=(0,fe.toBoolean)(r):e.setAttribute(t,String(r));break;default:(0,fe.toBoolean)(r)?(e.setAttribute(t,String(r)),t==="autofocus"&&document.body.getAttribute("data-mode")!=="design"&&setTimeout(()=>e.focus(),100)):e.removeAttribute(t)}}function On({node:e,dataSignal:t,id:r,path:o,ctx:n,namespace:a,instance:s}){let l=En(e,n,r);switch(l){case"svg":{a="http://www.w3.org/2000/svg";break}case"math":{a="http://www.w3.org/1998/Math/MathML";break}}e.attrs.xmlns&&e.attrs.xmlns.type==="value"&&(a=String(e.attrs.xmlns.value));let u=a?document.createElementNS(a,l):document.createElement(l);u.setAttribute("data-node-id",r),o&&u.setAttribute("data-id",o),n.isRootComponent===!1&&r!=="root"&&u.setAttribute("data-component",n.component.name);let f=(0,Ve.getClassName)([e.style,e.variants]);u.classList.add(f),s&&r==="root"&&Object.entries(s).forEach(([i,p])=>{u.classList.add((0,Ve.toValidClassName)(`${i}:${p}`))}),e.classes&&Object.entries(e.classes)?.forEach(([i,{formula:p}])=>{p?t.map(O=>(0,Ke.toBoolean)((0,Ae.applyFormula)(p,{data:O,component:n.component,formulaCache:n.formulaCache,root:n.root,package:n.package,toddle:n.toddle,env:n.env}))).subscribe(O=>O?u.classList.add(i):u.classList.remove(i)):u.classList.add(i)}),Object.entries(e.attrs).forEach(([i,p])=>{if(!(0,Ke.isDefined)(p))return;let b,O=()=>{p.type==="value"?vo(u,i,p?.value):(b=t.map(g=>(0,Ae.applyFormula)(p,{data:g,component:n.component,formulaCache:n.formulaCache,root:n.root,package:n.package,toddle:n.toddle,env:n.env})),b.subscribe(g=>{vo(u,i,g)}))};i==="autofocus"&&n.env.runtime==="preview"&&n.toddle._preview?n.toddle._preview.showSignal.subscribe(({testMode:g})=>{g?O():(b?.destroy(),u.removeAttribute(i))}):O()}),e["style-variables"]?.forEach(({formula:i,name:p,unit:b})=>{t.map(g=>{let C=(0,Ae.applyFormula)(i,{data:g,component:n.component,formulaCache:n.formulaCache,root:n.root,package:n.package,toddle:n.toddle,env:n.env});return b?C+b:C}).subscribe(g=>u.style.setProperty(`--${p}`,g))}),Object.values(e.events).forEach(i=>{let p=b=>(i.actions.forEach(O=>{if(b instanceof DragEvent&&(b.data=Cn(b)),b instanceof ClipboardEvent)try{b.data=Array.from(b.clipboardData?.items??[]).reduce((g,C)=>{try{g[C.type]=JSON.parse(b.clipboardData?.getData(C.type))}catch{g[C.type]=b.clipboardData?.getData(C.type)}return g},{})}catch(g){console.error("Could not get paste data"),console.error(g)}I(O,{...t.get(),Event:b},n,b)}),!1);u.addEventListener(i.trigger,p)});let A=e.tag.toLocaleLowerCase();if(A==="script"||A==="style"){let i=[];e.children.map(p=>n.component.nodes[p]).filter(p=>p?.type==="text").forEach(p=>{if(p.value.type==="value")i.push(String(p.value.value));else{let b=t.map(O=>String((0,Ae.applyFormula)(p.value,{data:O,component:n.component,formulaCache:n.formulaCache,root:n.root,package:n.package,toddle:n.toddle,env:n.env})));i.push(b)}}),i.every(p=>typeof p=="string")&&(u.textContent=i.join("")),i.filter(p=>typeof p!="string").forEach(p=>{p.subscribe(()=>{u.textContent=i.map(b=>typeof b=="string"?b:b.get()).join("")})})}else e.children.forEach((i,p)=>{ue({parentElement:u,id:i,path:o+"."+p,dataSignal:t,ctx:n,namespace:a,instance:s}).forEach(O=>u.appendChild(O))});return u}function jn({path:e,node:t,dataSignal:r,ctx:o,parentElement:n,instance:a,namespace:s}){let l=t.name??"default",u=[];if(o.children[l]?u=o.children[l].flatMap(f=>{let A=f.dataSignal.map(i=>i);return r.subscribe(i=>i,{destroy:()=>A.destroy()}),ue({...f,dataSignal:A,parentElement:n,ctx:{...f.ctx,providers:o.providers},instance:a,namespace:s})}):u=t.children.flatMap((f,A)=>ue({id:f,path:e+"."+A,dataSignal:r,ctx:o,parentElement:n,instance:a,namespace:s})),o.env.runtime==="custom-element"&&o.isRootComponent){let f=document.createElement("slot");return f.setAttribute("name",l),u.forEach(A=>{f.appendChild(A)}),[f]}return u}var wo=R(U());function Rn({node:e,id:t,path:r,dataSignal:o,namespace:n,ctx:a}){if(n&&n!=="http://www.w3.org/1999/xhtml")return mc({node:e,dataSignal:o,ctx:a});let{value:s}=e,l=document.createElement("span");return l.setAttribute("data-node-id",t),typeof t=="string"&&l.setAttribute("data-id",r),a.isRootComponent===!1&&l.setAttribute("data-component",a.component.name),l.setAttribute("data-node-type","text"),s.type!=="value"?o.map(f=>String((0,wo.applyFormula)(s,{data:f,component:a.component,formulaCache:a.formulaCache,root:a.root,package:a.package,toddle:a.toddle,env:a.env}))).subscribe(f=>{l.innerText=f}):l.innerText=String(s.value),l}function mc({node:e,dataSignal:t,ctx:r}){let{value:o}=e,n=document.createTextNode("");return o.type!=="value"?t.map(s=>String((0,wo.applyFormula)(o,{data:s,component:r.component,formulaCache:r.formulaCache,root:r.root,package:r.package,toddle:r.toddle,env:r.env}))).subscribe(s=>{n.nodeValue=s}):n.nodeValue=String(o.value),n}function ue({id:e,dataSignal:t,path:r,ctx:o,namespace:n,parentElement:a,instance:s}){let l=o.component.nodes[e];if(!l)return[];let u=({node:i,...p})=>{switch(i.type){case"element":return[On({node:i,...p})];case"component":let b=o.components.some(O=>O.name===i.name);return vn({node:{...i,id:e},...p,ctx:{...o,package:i.package??(b?void 0:o.package)},parentElement:a});case"text":return[Rn({...p,node:i})];case"slot":return jn({...p,node:i})}};function f({node:i,dataSignal:p,id:b,path:O,ctx:g,namespace:C,parentElement:h,instance:E}){let j=!0,w=null,d=p.map(v=>(0,Fn.toBoolean)((0,Je.applyFormula)(i.condition,{data:v,component:g.component,formulaCache:g.formulaCache,root:g.root,package:g.package,toddle:g.toddle,env:g.env}))),c=[],S=v=>{if(v&&c.length===0){if(w?.destroy(),w=p.map(F=>F),c.push(...u({node:i,dataSignal:w,path:O,id:b,ctx:g,namespace:C,parentElement:h,instance:E})),j)return;if(!h||g.root.contains(h)===!1){console.error(`Conditional: Parent element does not exist for "${O}" This is likely due to the DOM being modified outside of toddle.`);return}if(h.querySelector(`[data-id="${O}"]`)){console.warn(`Conditional: Element with data-id="${O}" already exists. This is likely due to the DOM being modified outside of toddle`);return}let y=yo(O,h);for(let F of c)h.insertBefore(F,y)}else v||(w?.destroy(),c.forEach(y=>y.remove()),c.splice(0,c.length))};return d.subscribe(S,{destroy:()=>{w?.destroy()}}),g.env.runtime==="preview"&&g.toddle._preview&&g.toddle._preview.showSignal.subscribe(({displayedNodes:v,testMode:y})=>{v.includes(O)&&!y?S(!0):S(d.get())}),j=!1,c}function A(){let i=!0,p=new Map;return t.map(O=>{let g=(0,Je.applyFormula)(l.repeat,{data:O,component:o.component,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env});return typeof g!="object"?[]:Object.entries(g??{})}).subscribe(O=>{let g=new Map;for(let C=0;C<O.length;C++){let[h,E]=O[C],j={...t.get(),ListItem:{...t.get().ListItem?{Parent:t.get().ListItem}:{},Item:E,Index:Number(C),Key:h}},w=l.repeatKey?(0,Je.applyFormula)(l.repeatKey,{data:j,component:o.component,formulaCache:o.formulaCache,root:o.root,package:o.package,toddle:o.toddle,env:o.env}):h;g.has(w)&&(console.warn(`Duplicate key "${w}" found in repeat. Fallback to index as key. This will cause a re-render of the duplicated children on every change.`),w=h);let d=p.get(w);if(d)g.set(w,d),d.dataSignal.update(c=>({...c,ListItem:{...t.get().ListItem?{Parent:t.get().ListItem}:{},Item:E,Index:Number(C),Key:h}}));else{let c=X(j),S=t.subscribe(F=>{i||c.update(({ListItem:k})=>({...F,ListItem:k}))},{destroy:()=>c.destroy()}),v={node:l,id:e,dataSignal:c,path:h==="0"?r:`${r}(${h})`,ctx:o,namespace:n,parentElement:a,instance:s},y=l.condition?f(v):u(v);g.set(w,{dataSignal:c,cleanup:S,elements:y})}}if(Array.from(p.entries()).forEach(([C,h])=>{g.has(C)||(h.cleanup(),h.dataSignal.destroy(),h.elements.forEach(E=>E.remove()))}),p=g,!(i||p.size===0)){if(!a||o.root.contains(a)===!1){console.error(`Repeat: Parent element does not exist for ${r}. This is likely due to the DOM being modified outside of toddle.`);return}mn(a,Array.from(p.values()).flatMap(C=>C.elements),yo(r,a))}},{destroy:()=>Array.from(p.values()).forEach(O=>{O.cleanup(),O.dataSignal.destroy(),O.elements.forEach(g=>g.remove())})}),i=!1,Array.from(p.values()).flatMap(O=>O.elements)}return l.repeat?A():l.condition?f({node:l,dataSignal:t,ctx:o,id:e,path:r,namespace:n,parentElement:a,instance:s}):u({node:l,dataSignal:t,ctx:o,id:e,path:r,namespace:n,parentElement:a,instance:s})}var gc=new qe;function xe({component:e,dataSignal:t,onEvent:r,isRootComponent:o,path:n,children:a,formulaCache:s,components:l,apis:u,abortSignal:f,root:A,providers:i,package:p,parentElement:b,instance:O,toddle:g,namespace:C,env:h}){let E={triggerEvent:r,component:e,components:l,dataSignal:t,isRootComponent:o,apis:u,formulaCache:s,children:a,abortSignal:f,root:A,providers:i,package:p,toddle:g,env:h},j=ue({id:"root",path:n,dataSignal:t,ctx:E,parentElement:b,namespace:C,instance:O});return gc.add(()=>{let w;e.onAttributeChange?.actions&&e.onAttributeChange.actions.length>0&&t.map(d=>d.Attributes).subscribe(d=>{w&&e.onAttributeChange?.actions.forEach(c=>{I(c,t.get(),E,new CustomEvent("attribute-change",{detail:Object.entries(d).reduce((S,[v,y])=>((0,Tn.default)(y,w[v])===!1&&e.attributes[v]?.name&&(S[e.attributes[v]?.name]={current:w[v],new:y}),S),{})}))}),w=d}),e.onLoad?.actions.forEach(d=>{I(d,t.get(),E)})}),j}hn();var ae,Id=e=>{let t=window.__toddle.component,{params:r,hash:o,query:n}=Dn(t);ae={isServer:!1,branchName:window.__toddle.branch,request:void 0,runtime:"page",logErrors:!0},window.toddle=(()=>{let a={},s={},l={},u={isEqual:kn.default,errors:[],project:window.__toddle.project,branch:window.__toddle.branch,commit:window.__toddle.commit,components:window.__toddle.components,formulas:e?.formulas??{},actions:e?.actions??{},registerAction:(f,A)=>{if(a[f]){console.error("There already exists an action with the name ",f);return}a[f]=A},getAction:f=>a[f],registerFormula:(f,A,i)=>{if(s[f]){console.error("There already exists a formula with the name ",f);return}s[f]=A,i&&(l[f]=i)},getFormula:f=>s[f],getCustomAction:(f,A)=>u.actions[A??window.__toddle.project]?.[f]??u.actions[window.__toddle.project]?.[f],getCustomFormula:(f,A)=>u.formulas[A??window.__toddle.project]?.[f]??u.formulas[window.__toddle.project]?.[f],getArgumentInputData:(f,A,i,p)=>l[f]?.(A,i,p)||p,data:{},locationSignal:X({route:t.route,page:t.page,path:window.location.pathname,params:r,query:n,hash:o}),eventLog:[],pageState:window.__toddle.pageState,env:ae};return u})(),Object.entries(fo).forEach(([a,s])=>window.toddle.registerFormula("@toddle/"+a,s.default,"getArgumentInputData"in s?s.getArgumentInputData:void 0)),Object.entries(At).forEach(([a,s])=>window.toddle.registerAction("@toddle/"+a,s.default))},_d=e=>{let t=window.__toddle.component;if(!e)throw new Error("Cant find root domNode");if(!window.toddle.components)throw new Error("Missing components");let r=window.toddle.locationSignal.map(({query:g,page:C,route:h,params:E,hash:j})=>{let w;if(h){let S=[];for(let v of h.path)if(v.type==="static")S.push(v.name);else{let y=E[v.name];if((0,ne.isDefined)(y))S.push(y);else break}w="/"+S.join("/")}else w=ln(C,{encode:encodeURIComponent})(E);let d=j===void 0||j===""?"":"#"+j,c=Object.entries(g).filter(([S,v])=>v!==null).map(([S,v])=>`${encodeURIComponent(t?.route?.query[S]?.name??S)}=${encodeURIComponent(String(v))}`).join("&");return`${w}${d}${c.length>0?"?"+c:""}`});window.addEventListener("popstate",()=>{if(!t)return;let{params:g,hash:C,query:h}=Dn(t);window.toddle.locationSignal.update(()=>({route:t?.route,page:t.page,path:window.location.pathname,params:g,query:h,hash:C}))}),r.subscribe(g=>{let[C]=g.split("?");C==window.location.pathname?window.history.replaceState({},"",g):window.history.pushState({},"",g)});let o=window.toddle.locationSignal.map(({query:g,params:C})=>({...g,...C})),n=X({...window.toddle.pageState,Variables:(0,Nn.mapObject)(t.variables,([g,C])=>[g,(0,pe.applyFormula)(C.initialValue,{data:window.toddle.pageState,component:t,formulaCache:{},root:document,package:void 0,toddle:window.toddle,env:ae})])}),a=t.route?.info?.title?.formula;a&&a.type!=="value"&&n.map(()=>t?(0,pe.applyFormula)(a,{data:n.get(),component:t,root:document,package:void 0,toddle:window.toddle,env:ae}):null).subscribe(g=>{(0,ne.isDefined)(g)&&document.title!==g&&(document.title=g)});let l=t.route?.info?.description?.formula,u=t.route?.info?.meta,f=l&&l.type!=="value",A=Object.values(u??{}).some(g=>Object.values(g.attrs??{}).some(C=>C.type!=="value"));if(f||A){let g=h=>[...document.getElementsByTagName("meta")].find(E=>E.name===h||E.getAttribute("property")===h)??null,C=(h,E)=>{let j=null;if((0,ne.isDefined)(E))j=document.querySelector(`[data-toddle-id="${E}"]`);else{let w=Object.entries(h.attrs??{}).find(([d])=>["property","name"].includes(d.toLowerCase()))?.[1];(0,ne.isDefined)(w)&&(j=g(w))}j||(j=document.createElement(h.tag),(0,ne.isDefined)(E)&&j.setAttribute("data-toddle-id",E),document.getElementsByTagName("head")[0].appendChild(j)),Object.entries(h.attrs??{}).forEach(([w,d])=>{t&&j.setAttribute(w,d)})};f&&n.map(h=>t?(0,pe.applyFormula)(l,{data:h,component:t,root:document,package:void 0,toddle:window.toddle,env:ae}):null).subscribe(h=>{if((0,ne.isDefined)(h)){let E=document.getElementsByTagName("meta").namedItem("description");E||(E=document.createElement("meta"),E.name="description"),E.content=h,document.getElementsByTagName("head")[0].appendChild(E),u&&!Object.values(u).some(j=>Object.entries(j.attrs??{}).some(([w,d])=>w.toLowerCase()==="property"&&d.type==="value"&&typeof d.value=="string"&&d.value.toLowerCase()==="og:description"))&&C({tag:"meta",attrs:{property:"og:description",content:h}})}}),A&&Object.entries(u??{}).filter(([h,E])=>Object.values(E.attrs??{}).some(j=>j.type!=="value")).forEach(([h,E])=>{n.map(j=>Object.entries(E.attrs??{}).reduce((d,[c,S])=>t?{...d,[c]:(0,pe.applyFormula)(S,{data:j,component:t,root:document,package:void 0,toddle:window.toddle,env:ae})}:d,{})).subscribe(j=>C({tag:E.tag,attrs:j},h))})}$e(t,n),o.subscribe(g=>n.update(C=>({...C,"URL parameters":g,Attributes:g})));let i=new AbortController;n.subscribe(()=>{},{destroy:()=>i.abort(`Component ${t.name} unmounted`)});let p={component:t,components:window.toddle.components,root:document,isRootComponent:!0,dataSignal:n,abortSignal:i.signal,children:{},formulaCache:{},providers:{},apis:{},toddle:window.toddle,triggerEvent:(g,C)=>console.info("EVENT FIRED",g,C),package:void 0,env:ae};(0,We.sortApiObjects)(Object.entries(t.apis)).forEach(([g,C])=>{(0,We.isLegacyApi)(C)?p.apis[g]=De(C,p):p.apis[g]=_e(C,p)}),Object.values(p.apis).filter(g=>g.triggerActions!==void 0).forEach(g=>{g.triggerActions()});let b=p.providers;if(Le(t)){let g=Object.fromEntries(Object.entries(t.formulas??{}).filter(([,C])=>C.exposeInContext).map(([C,h])=>[C,n.map(E=>(0,pe.applyFormula)(h.formula,{data:E,component:t,formulaCache:p.formulaCache,root:p.root,package:p.package,toddle:window.toddle,env:ae}))]));b={...b,[t.name]:{component:t,formulaDataSignals:g,ctx:p}}}let O=xe({...p,providers:b,path:"0",package:void 0,onEvent:p.triggerEvent,parentElement:e,instance:{}});e.innerText="",O.forEach(g=>{e.appendChild(g)}),window.__toddle.isPageLoaded=!0};function Dn(e){let t=window.location.pathname.split("/").slice(1),r={};e.route?e.route.path.forEach((s,l)=>{s.type==="param"?(0,ne.isDefined)(t[l])&&t[l]!==""?r[s.name]=decodeURIComponent(t[l]):r[s.name]=null:r[s.name]=s.name}):r=(un(e.page??"",{decode:decodeURIComponent})(window.location.pathname)||{params:{}}).params;let[o]=window.location.hash.split("?"),n=hc(window.location.search),a=Object.keys(e.route?.query??{}).reduce((s,l)=>({...s,[l]:null}),{});return{params:r,hash:o?.slice(1),query:{...a,...n}}}var hc=e=>Object.fromEntries(e.replace("?","").split("&").filter(t=>t!=="").map(t=>t.split("=").map(decodeURIComponent)));export{_d as createRoot,Id as initGlobalObject};
//# sourceMappingURL=esm-page.main.js.map
